dashboards:
  GRAVITON_SAVINGS_DASHBOARD:
    dependsOn:
      datasets:
      - graviton_ec2_view
      - graviton_elasticache_view
      - graviton_mapping
      - graviton_opensearch_view
      - graviton_rds_view
    name: Graviton Savings Dashboard
    dashboardId: graviton-savings
    category: Advanced
    theme: MIDNIGHT
    version: v3.0.0
    file: ./graviton_savings_dashboard-definition.yaml
    nonTaxonomyDatasets:
    - graviton_mapping
datasets:
  graviton_opensearch_view:
    data:
      DataSetId: 4398c46d-4d15-48b8-863d-c9275e0aa833
      Name: graviton_opensearch_view
      PhysicalTableMap:
        25ebc7a6-65b7-47a5-abd8-003128d25bbc:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        545587c0-8fb4-4299-9ecd-b6d8987626fa:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: graviton_opensearch_view
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: bill_billing_period_start_date
              Type: STRING
            - Name: line_item_resource_id
              Type: STRING
            - Name: product_instance_type
              Type: STRING
            - Name: instance_family
              Type: STRING
            - Name: processor_type
              Type: STRING
            - Name: product_location
              Type: STRING
            - Name: pricing_term
              Type: STRING
            - Name: pricing_lease_contract_length
              Type: STRING
            - Name: pricing_offering_class
              Type: STRING
            - Name: pricing_purchase_option
              Type: STRING
            - Name: pricing_unit
              Type: STRING
            - Name: generation
              Type: STRING
            - Name: graviton_instance
              Type: STRING
            - Name: previous_intel_instance
              Type: STRING
            - Name: tags_json
              Type: STRING
            - Name: line_item_usage_amount
              Type: DECIMAL
              SubType: FLOAT
            - Name: line_item_vcpu_normalized_usage_amount
              Type: DECIMAL
              SubType: FLOAT
            - Name: line_item_unblended_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: engine
              Type: STRING
            - Name: version
              Type: STRING
            - Name: graviton_eligibility
              Type: STRING
            - Name: graviton_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_savings
              Type: DECIMAL
              SubType: FLOAT
            - Name: intel_equivilant_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: existing_savings
              Type: DECIMAL
              SubType: FLOAT
      LogicalTableMap:
        37c6d9b0-0a02-47b6-81de-49aa85dfe5b7:
          Alias: account_map
          Source:
            PhysicalTableId: 25ebc7a6-65b7-47a5-abd8-003128d25bbc
        68d08e84-8504-4e4a-ad70-bb49d9df1d3e:
          Alias: graviton_opensearch_view
          DataTransforms:
          - CastColumnTypeOperation:
              ColumnName: bill_billing_period_start_date
              NewColumnType: DATETIME
              Format: yyyy-MM-dd
          Source:
            PhysicalTableId: 545587c0-8fb4-4299-9ecd-b6d8987626fa
        6b4a2c63-6313-442d-92cd-c7f298db8ba5:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - bill_billing_period_start_date
              - line_item_resource_id
              - product_instance_type
              - instance_family
              - processor_type
              - product_location
              - pricing_term
              - pricing_lease_contract_length
              - pricing_offering_class
              - pricing_purchase_option
              - pricing_unit
              - generation
              - graviton_instance
              - previous_intel_instance
              - tags_json
              - line_item_usage_amount
              - line_item_vcpu_normalized_usage_amount
              - line_item_unblended_cost
              - amortized_cost
              - engine
              - version
              - graviton_eligibility
              - graviton_price
              - graviton_savings
              - intel_equivilant_price
              - existing_savings
              - account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: 68d08e84-8504-4e4a-ad70-bb49d9df1d3e
              RightOperand: 37c6d9b0-0a02-47b6-81de-49aa85dfe5b7
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - graviton_mapping
      - modernization_mapping
      - graviton_opensearch_view
    schedules:
    - default
  graviton_elasticache_view:
    data:
      DataSetId: 1e39a381-beda-4c55-b7e5-4b3bf159c9c8
      Name: graviton_elasticache_view
      PhysicalTableMap:
        1200c855-886f-45ad-b974-f8e1cc1c4241:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: graviton_elasticache_view
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: month_line_item_usage_start_date
              Type: STRING
            - Name: split_line_item_resource_id
              Type: STRING
            - Name: split_line_item_usage_type
              Type: STRING
            - Name: product_location
              Type: STRING
            - Name: pricing_term
              Type: STRING
            - Name: product_cache_engine
              Type: STRING
            - Name: case_purchase_option
              Type: STRING
            - Name: pricing_lease_contract_length
              Type: STRING
            - Name: pricing_offering_class
              Type: STRING
            - Name: pricing_purchase_option
              Type: STRING
            - Name: pricing_unit
              Type: STRING
            - Name: processor_type
              Type: STRING
            - Name: generation
              Type: STRING
            - Name: graviton_family
              Type: STRING
            - Name: previous_intel_family
              Type: STRING
            - Name: graviton_instance
              Type: STRING
            - Name: previous_intel
              Type: STRING
            - Name: tags_json
              Type: STRING
            - Name: sum_line_item_usage_amount
              Type: DECIMAL
              SubType: FLOAT
            - Name: sum_line_item_unblended_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: sum_amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: sum_ri_trueup
              Type: DECIMAL
              SubType: FLOAT
            - Name: ri_upfront_fees
              Type: DECIMAL
              SubType: FLOAT
            - Name: engineversion
              Type: STRING
            - Name: graviton_eligibility
              Type: STRING
            - Name: graviton_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_savings
              Type: DECIMAL
              SubType: FLOAT
            - Name: existing_savings
              Type: DECIMAL
              SubType: FLOAT
            - Name: intel_equivilant_price
              Type: DECIMAL
              SubType: FLOAT
        17470ef2-0a70-405c-8e06-e9ed2d4186cf:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: account_name
              Type: STRING
      LogicalTableMap:
        1b39e3f4-7bfa-4347-91e2-0ec6223b701e:
          Alias: account_map
          Source:
            PhysicalTableId: 17470ef2-0a70-405c-8e06-e9ed2d4186cf
        26ddf555-2dad-45a2-a976-3e8277ccf2dc:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - month_line_item_usage_start_date
              - split_line_item_resource_id
              - split_line_item_usage_type
              - product_location
              - pricing_term
              - product_cache_engine
              - case_purchase_option
              - pricing_lease_contract_length
              - pricing_offering_class
              - pricing_purchase_option
              - pricing_unit
              - processor_type
              - generation
              - graviton_family
              - previous_intel_family
              - graviton_instance
              - previous_intel
              - tags_json
              - sum_line_item_usage_amount
              - sum_line_item_unblended_cost
              - sum_amortized_cost
              - sum_ri_trueup
              - ri_upfront_fees
              - engineversion
              - graviton_eligibility
              - graviton_cost
              - graviton_savings
              - existing_savings
              - intel_equivilant_price
              - account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: c396053c-26e8-42ae-8c03-df2215bc9ecb
              RightOperand: 1b39e3f4-7bfa-4347-91e2-0ec6223b701e
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
        c396053c-26e8-42ae-8c03-df2215bc9ecb:
          Alias: graviton_elasticache_view
          DataTransforms:
          - CastColumnTypeOperation:
              ColumnName: month_line_item_usage_start_date
              NewColumnType: DATETIME
              Format: yyyy-MM
          Source:
            PhysicalTableId: 1200c855-886f-45ad-b974-f8e1cc1c4241
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - graviton_mapping
      - modernization_mapping
      - graviton_elasticache_view
    schedules:
    - default
  graviton_mapping:
    data:
      DataSetId: ffe1d9b3-1cbc-4f8d-afa9-8750170fafb3
      Name: graviton_mapping
      PhysicalTableMap:
        f21ec750-639f-4f51-9ca0-f39b7ff449f3:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: graviton_mapping
            InputColumns:
            - Name: source_instance_type
              Type: STRING
            - Name: location
              Type: STRING
            - Name: termtype
              Type: STRING
            - Name: operation
              Type: STRING
            - Name: region_code
              Type: STRING
            - Name: leasecontractlength
              Type: STRING
            - Name: purchaseoption
              Type: STRING
            - Name: offeringclass
              Type: STRING
            - Name: effective_priceperunit
              Type: DECIMAL
              SubType: FLOAT
            - Name: prev_intel_instance_type
              Type: STRING
            - Name: prev_intel_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: prev_intel_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: default_grav_instance_type
              Type: STRING
            - Name: default_grav_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: default_grav_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: g2_instance_type
              Type: STRING
            - Name: g3_instance_type
              Type: STRING
            - Name: g4_instance_type
              Type: STRING
            - Name: g2_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: g3_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: g4_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: g2_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: g3_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: g4_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
      LogicalTableMap:
        9e05bd35-6bef-4e0c-b2b3-5650e29dbab7:
          Alias: graviton_mapping
          DataTransforms:
          - TagColumnOperation:
              ColumnName: region_code
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - source_instance_type
              - location
              - termtype
              - operation
              - region_code
              - leasecontractlength
              - purchaseoption
              - offeringclass
              - effective_priceperunit
              - prev_intel_instance_type
              - prev_intel_price
              - prev_intel_savings_percentage
              - default_grav_instance_type
              - default_grav_price
              - default_grav_savings_percentage
              - g2_instance_type
              - g3_instance_type
              - g4_instance_type
              - g2_price
              - g3_price
              - g4_price
              - g2_savings_percentage
              - g3_savings_percentage
              - g4_savings_percentage
          Source:
            PhysicalTableId: f21ec750-639f-4f51-9ca0-f39b7ff449f3
      ImportMode: SPICE
    dependsOn:
      views:
      - graviton_mapping
    schedules:
    - default
  graviton_ec2_view:
    data:
      DataSetId: 96e46197-d03a-41b1-b564-1cf2da51a2d7
      Name: graviton_ec2_view
      PhysicalTableMap:
        22b8a470-d369-4904-ab86-203f79fd69b4:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        999e0f84-a1e1-4241-8698-17abb947484d:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: graviton_ec2_view
            InputColumns:
            - Name: billing_period
              Type: DATETIME
            - Name: usage_date
              Type: STRING
            - Name: payer_account_id
              Type: STRING
            - Name: linked_account_id
              Type: STRING
            - Name: existing_instance
              Type: STRING
            - Name: charge_type
              Type: STRING
            - Name: purchase_option
              Type: STRING
            - Name: region
              Type: STRING
            - Name: location
              Type: STRING
            - Name: product_operating_system
              Type: STRING
            - Name: line_item_operation
              Type: STRING
            - Name: processor_type
              Type: STRING
            - Name: product_instance_type_family
              Type: STRING
            - Name: size
              Type: STRING
            - Name: contract_length
              Type: STRING
            - Name: offering_type
              Type: STRING
            - Name: offering_type_mapping_only_column
              Type: STRING
            - Name: payment_option
              Type: STRING
            - Name: tags_json
              Type: STRING
            - Name: usage_quantity
              Type: DECIMAL
              SubType: FLOAT
            - Name: normalized_usage_quantity
              Type: DECIMAL
              SubType: FLOAT
            - Name: unblended_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_instance_exists
              Type: STRING
            - Name: ineligibility_reason
              Type: STRING
            - Name: previous_intel_instance
              Type: STRING
            - Name: previous_intel_rate
              Type: DECIMAL
              SubType: FLOAT
            - Name: previous_intel_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: prev_intel_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_instance
              Type: STRING
            - Name: graviton_rate
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: default_grav_instance_type
              Type: STRING
            - Name: default_grav_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: default_grav_amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: default_grav_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: g2_instance_type
              Type: STRING
            - Name: g2_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: g2_amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: g2_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: g3_instance_type
              Type: STRING
            - Name: g3_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: g3_amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: g3_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: g4_instance_type
              Type: STRING
            - Name: g4_price
              Type: DECIMAL
              SubType: FLOAT
            - Name: g4_amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: g4_savings_percentage
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_savings_potential
              Type: DECIMAL
              SubType: FLOAT
            - Name: default_g_savings_potential
              Type: DECIMAL
              SubType: FLOAT
            - Name: g2_savings_potential
              Type: DECIMAL
              SubType: FLOAT
            - Name: g3_savings_potential
              Type: DECIMAL
              SubType: FLOAT
            - Name: g4_savings_potential
              Type: DECIMAL
              SubType: FLOAT
      LogicalTableMap:
        1da2b3b3-bbdf-4b99-9d9b-d7ed7c8a8ec1:
          Alias: Intermediate Table
          DataTransforms:
          - TagColumnOperation:
              ColumnName: region
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - billing_period
              - usage_date
              - payer_account_id
              - linked_account_id
              - existing_instance
              - charge_type
              - purchase_option
              - region
              - location
              - product_operating_system
              - line_item_operation
              - processor_type
              - product_instance_type_family
              - size
              - contract_length
              - offering_type
              - offering_type_mapping_only_column
              - payment_option
              - tags_json
              - usage_quantity
              - normalized_usage_quantity
              - unblended_cost
              - amortized_cost
              - graviton_instance_exists
              - ineligibility_reason
              - previous_intel_instance
              - previous_intel_rate
              - previous_intel_price
              - prev_intel_savings_percentage
              - graviton_instance
              - graviton_rate
              - graviton_price
              - default_grav_instance_type
              - default_grav_price
              - default_grav_amortized_cost
              - default_grav_savings_percentage
              - g2_instance_type
              - g2_price
              - g2_amortized_cost
              - g2_savings_percentage
              - g3_instance_type
              - g3_price
              - g3_amortized_cost
              - g3_savings_percentage
              - g4_instance_type
              - g4_price
              - g4_amortized_cost
              - g4_savings_percentage
              - graviton_savings_potential
              - default_g_savings_potential
              - g2_savings_potential
              - g3_savings_potential
              - g4_savings_potential
              - account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: b5c98a29-e7a2-4730-a4db-981062f73ed8
              RightOperand: c24cd10c-1927-4f3a-b06b-61d242508898
              Type: LEFT
              OnClause: '{linked_account_id} = {account_id}'
        b5c98a29-e7a2-4730-a4db-981062f73ed8:
          Alias: graviton_ec2_view
          Source:
            PhysicalTableId: 999e0f84-a1e1-4241-8698-17abb947484d
        c24cd10c-1927-4f3a-b06b-61d242508898:
          Alias: account_map
          Source:
            PhysicalTableId: 22b8a470-d369-4904-ab86-203f79fd69b4
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - graviton_mapping
      - graviton_ec2_view
    schedules:
    - default
  graviton_rds_view:
    data:
      DataSetId: 5b0e1590-d9f3-46f3-a2c2-307fafc58549
      Name: graviton_rds_view
      PhysicalTableMap:
        8881bb67-3603-4d41-a2a4-bc0752d99e7e:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        acc44c01-556f-450c-9f77-9932c0a76468:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: graviton_rds_view
            InputColumns:
            - Name: bill_payer_account_id
              Type: STRING
            - Name: line_item_usage_account_id
              Type: STRING
            - Name: bill_billing_period_start_date
              Type: DATETIME
            - Name: product_instance_type
              Type: STRING
            - Name: product_storage
              Type: STRING
            - Name: pricing_term
              Type: STRING
            - Name: pricing_lease_contract_length
              Type: STRING
            - Name: pricing_purchase_option
              Type: STRING
            - Name: pricing_unit
              Type: STRING
            - Name: line_item_resource_id
              Type: STRING
            - Name: product_storage_type
              Type: STRING
            - Name: rds_type
              Type: STRING
            - Name: db_engine
              Type: STRING
            - Name: line_item_availability_zone
              Type: STRING
            - Name: product_location
              Type: STRING
            - Name: product_instance_type_family
              Type: STRING
            - Name: processor_type
              Type: STRING
            - Name: product_deployment_option
              Type: STRING
            - Name: line_item_unblended_rate
              Type: STRING
            - Name: pricing_public_on_demand_rate
              Type: STRING
            - Name: generation
              Type: STRING
            - Name: latest_arm
              Type: STRING
            - Name: graviton_instance_type
              Type: STRING
            - Name: latest_intel_instance_type
              Type: STRING
            - Name: tags_json
              Type: STRING
            - Name: line_item_usage_amount
              Type: DECIMAL
              SubType: FLOAT
            - Name: line_item_unblended_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: sum_amortized_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: engineversion
              Type: STRING
            - Name: graviton_eligible
              Type: STRING
            - Name: storage
              Type: STRING
            - Name: new_intel_storage
              Type: STRING
            - Name: storage_type
              Type: STRING
            - Name: graviton_unit_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: graviton_unblended_savings
              Type: DECIMAL
              SubType: FLOAT
            - Name: previous_intel_unit_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: previous_intel_cost
              Type: DECIMAL
              SubType: FLOAT
            - Name: previous_intel_unblended_savings
              Type: DECIMAL
              SubType: FLOAT
      LogicalTableMap:
        1f223ea9-ceda-40fa-ae3c-d47baaaad027:
          Alias: account_map
          Source:
            PhysicalTableId: 8881bb67-3603-4d41-a2a4-bc0752d99e7e
        29386d16-d357-42fa-8dac-eaab3f2ad8fb:
          Alias: graviton_rds_view
          Source:
            PhysicalTableId: acc44c01-556f-450c-9f77-9932c0a76468
        bb1eb85f-bf6c-46c8-beb7-4c6245f5a9fd:
          Alias: Intermediate Table
          DataTransforms:
          - ProjectOperation:
              ProjectedColumns:
              - bill_payer_account_id
              - line_item_usage_account_id
              - bill_billing_period_start_date
              - product_instance_type
              - product_storage
              - pricing_term
              - pricing_lease_contract_length
              - pricing_purchase_option
              - pricing_unit
              - line_item_resource_id
              - product_storage_type
              - rds_type
              - db_engine
              - line_item_availability_zone
              - product_location
              - product_instance_type_family
              - processor_type
              - product_deployment_option
              - line_item_unblended_rate
              - pricing_public_on_demand_rate
              - generation
              - latest_arm
              - graviton_instance_type
              - latest_intel_instance_type
              - line_item_usage_amount
              - line_item_unblended_cost
              - sum_amortized_cost
              - engineversion
              - graviton_eligible
              - storage
              - new_intel_storage
              - storage_type
              - graviton_unit_cost
              - graviton_cost
              - graviton_unblended_savings
              - previous_intel_unit_cost
              - previous_intel_cost
              - previous_intel_unblended_savings
              - account_id
              - account_name
          Source:
            JoinInstruction:
              LeftOperand: 29386d16-d357-42fa-8dac-eaab3f2ad8fb
              RightOperand: 1f223ea9-ceda-40fa-ae3c-d47baaaad027
              Type: LEFT
              OnClause: '{line_item_usage_account_id} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - modernization_mapping
      - graviton_mapping
      - graviton_rds_view
    schedules:
    - default
crawlers: {}
views:
  graviton_opensearch_view:
    parameters:
      data_collection_database_name:
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True   
    dependsOn:
      tags: json
      views:
        - modernization_mapping
        - graviton_mapping  
      cur2:
      - bill_billing_period_start_date
      - bill_payer_account_id
      - billing_period
      - line_item_line_item_type
      - line_item_product_code
      - line_item_resource_id
      - line_item_unblended_cost
      - line_item_usage_account_id
      - line_item_usage_amount
      - pricing_lease_contract_length
      - pricing_offering_class
      - pricing_purchase_option
      - pricing_term
      - pricing_unit
      - product
      - product_instance_type
      - product_location
      - product_product_family
      - product['vcpu']
      - reservation_effective_cost
      - reservation_reservation_a_r_n
      - reservation_unused_amortized_upfront_fee_for_billing_period
      - reservation_unused_recurring_fee
      - resource_tags
      - savings_plan_savings_plan_effective_cost
      - savings_plan_total_commitment_to_date
      - savings_plan_used_commitment
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".graviton_opensearch_view AS
      WITH
        cur_data AS (
         SELECT
           cur.bill_payer_account_id
         , cur.line_item_usage_account_id
         , DATE_FORMAT(cur.bill_billing_period_start_date, '%Y-%m-%d') bill_billing_period_start_date
         , SPLIT_PART(cur.line_item_resource_id, '/', 2) line_item_resource_id
         , cur.product_instance_type
         , SPLIT_PART(product_instance_type, '.', 1) instance_family
         , (CASE WHEN (SPLIT_PART(product_instance_type, '.', 1) LIKE '%g%') THEN 'Graviton' ELSE 'Intel' END) processor_type
         , cur.product_location
         , cur.pricing_term
         , COALESCE(cur.pricing_lease_contract_length, '') pricing_lease_contract_length
         , COALESCE(cur.pricing_offering_class, '') pricing_offering_class
         , COALESCE(cur.pricing_purchase_option, '') pricing_purchase_option
         , pricing_unit
         , map.generation
         , (CASE WHEN (map.latest_arm <> '') THEN CONCAT(map.latest_arm, '.', SPLIT_PART(cur.product_instance_type, '.', 2), '.search') ELSE '' END) graviton_instance
         , (CASE WHEN (map.previous_intel <> '') THEN CONCAT(map.previous_intel, '.', SPLIT_PART(cur.product_instance_type, '.', 2), '.search') ELSE '' END) previous_intel_instance
         , ${cur_tags_json} tags_json
         , SUM((CASE WHEN (cur.line_item_line_item_type = 'SavingsPlanCoveredUsage') THEN cur.line_item_usage_amount WHEN (cur.line_item_line_item_type = 'DiscountedUsage') THEN cur.line_item_usage_amount WHEN (cur.line_item_line_item_type = 'Usage') THEN cur.line_item_usage_amount ELSE 0 END)) line_item_usage_amount
         , (SUM((CASE WHEN (cur.line_item_line_item_type = 'SavingsPlanCoveredUsage') THEN cur.line_item_usage_amount WHEN (cur.line_item_line_item_type = 'DiscountedUsage') THEN cur.line_item_usage_amount WHEN (cur.line_item_line_item_type = 'Usage') THEN cur.line_item_usage_amount ELSE 0 END)) * CAST(NULLIF(COALESCE(product['vcpu'], '0'), '') AS double)) line_item_vcpu_normalized_usage_amount
         , SUM(line_item_unblended_cost) line_item_unblended_cost
         , SUM((CASE WHEN (cur.line_item_line_item_type = 'SavingsPlanCoveredUsage') THEN cur.savings_plan_savings_plan_effective_cost WHEN (cur.line_item_line_item_type = 'SavingsPlanRecurringFee') THEN (cur.savings_plan_total_commitment_to_date - cur.savings_plan_used_commitment) WHEN (cur.line_item_line_item_type = 'SavingsPlanNegation') THEN 0 WHEN (cur.line_item_line_item_type = 'SavingsPlanUpfrontFee') THEN 0 WHEN (cur.line_item_line_item_type = 'DiscountedUsage') THEN cur.reservation_effective_cost WHEN (cur.line_item_line_item_type = 'RIFee') THEN (cur.reservation_unused_amortized_upfront_fee_for_billing_period + cur.reservation_unused_recurring_fee) WHEN ((cur.line_item_line_item_type = 'Fee') AND (cur.reservation_reservation_a_r_n <> '')) THEN 0 ELSE cur.line_item_unblended_cost END)) amortized_cost
         FROM
           ("${cur2_database}"."${cur2_table_name}" cur
         LEFT JOIN modernization_mapping map ON (CONCAT(SPLIT_PART(cur.product_instance_type, '.', 1), '.search') = map.family))
         WHERE ((cur.product['product_name'] IN ('Amazon Elasticsearch Service', 'Amazon OpenSearch Service')) AND (cur.line_item_product_code = 'AmazonES') AND (cur.line_item_line_item_type IN ('DiscountedUsage', 'Usage', 'SavingsPlanCoveredUsage')) AND (cur.product_product_family = 'Amazon OpenSearch Service Instance') AND (("bill_billing_period_start_date" >= ("date_trunc"('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(concat(split_part("billing_period", '-', 1), '-', split_part("billing_period", '-', 2), '-01') AS date) >= ("date_trunc"('month', current_date) - INTERVAL  '7' MONTH))))
         GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, cur.product['vcpu']
      )
      , describe_domains AS (
         SELECT DISTINCT
           domainname
         , engineversion
         , SPLIT_PART(engineversion, '_', 1) engine
         , SPLIT_PART(engineversion, '_', 2) version
         , SPLIT_PART(SPLIT_PART(engineversion, '_', 2), '.', 1) major
         , SPLIT_PART(SPLIT_PART(engineversion, '_', 2), '.', 2) minor
         FROM
           ${data_collection_database_name}.inventory_opensearch_domains_data
      )
      , pricing AS (
         SELECT
           od.location
         , od."instance type"
         , (CASE WHEN (od.TermType = 'OnDemand') THEN 'OnDemand' WHEN (od.TermType = 'Reserved') THEN 'Reserved Instance' ELSE od.TermType END) TermType
         , od.operation
         , od.leasecontractlength
         , od.purchaseoption
         , od.offeringclass
         , od.unit
         , (CASE WHEN (od.TermType = 'OnDemand') THEN CAST(od.priceperunit AS double) WHEN (od.TermType = 'Reserved') THEN COALESCE((CAST(od.priceperunit AS double) + (CAST(fee.priceperunit AS double) / ((CAST(RTRIM(fee.leasecontractlength, 'yr') AS int) * 24) * 365))), CAST(od.priceperunit AS double)) ELSE 0 END) effective_priceperunit
         FROM
           (${data_collection_database_name}.pricing_opensearch_data od
         LEFT JOIN ${data_collection_database_name}.pricing_opensearch_data fee ON ((od.sku = fee.sku) AND (od."region code" = fee."region code") AND (fee.purchaseoption = od.purchaseoption) AND (fee.leasecontractlength = od.leasecontractlength) AND (fee.unit = 'Quantity') AND (od.offeringclass = fee.offeringclass)))
         WHERE ((od."instance type" <> '') AND (od.operation = 'ESDomain') AND (od.unit = 'Hrs'))
      )
      SELECT
        cur.*
      , describe_domains.engine
      , describe_domains.version
      , (CASE WHEN (describe_domains.engine = 'OpenSearch') THEN 'Eligible' WHEN (describe_domains.engine = 'Elasticsearch') THEN (CASE WHEN (describe_domains.major > '7') THEN 'Eligible' WHEN ((describe_domains.major = '7') AND (describe_domains.minor >= '9')) THEN 'Eligible' WHEN ((describe_domains.major = '7') AND (describe_domains.minor < '9')) THEN 'Requires Update' WHEN (describe_domains.major < '7') THEN 'Requires Update' END) END) graviton_eligibility
      , (PL1.effective_priceperunit * cur.line_item_usage_amount) graviton_price
      , (cur.amortized_cost - (PL1.effective_priceperunit * cur.line_item_usage_amount)) graviton_savings
      , (PL2.effective_priceperunit * cur.line_item_usage_amount) intel_equivilant_price
      , ((PL2.effective_priceperunit * cur.line_item_usage_amount) - cur.amortized_cost) existing_savings
      FROM
        (((cur_data cur
      LEFT JOIN describe_domains ON (cur.line_item_resource_id = describe_domains.domainname))
      LEFT JOIN pricing PL1 ON ((PL1."instance type" = cur.graviton_instance) AND (PL1.location = cur.product_location) AND (PL1.termtype = (CASE WHEN (cur.pricing_term = 'Reserved') THEN 'Reserved Instance' ELSE cur.pricing_term END)) AND (COALESCE(PL1.leasecontractlength, '') = COALESCE(cur.pricing_lease_contract_length, '')) AND (COALESCE(PL1.purchaseoption, '') = COALESCE(cur.pricing_purchase_option, '')) AND (COALESCE(PL1.offeringclass, '') = COALESCE(cur.pricing_offering_class, '')) AND (cur.pricing_unit = PL1.unit)))
      LEFT JOIN pricing PL2 ON ((PL2."instance type" = cur.previous_intel_instance) AND (PL2.location = cur.product_location) AND (PL2.termtype = (CASE WHEN (cur.pricing_term = 'Reserved') THEN 'Reserved Instance' ELSE cur.pricing_term END)) AND (COALESCE(PL2.leasecontractlength, '') = COALESCE(cur.pricing_lease_contract_length, '')) AND (COALESCE(PL2.purchaseoption, '') = COALESCE(cur.pricing_purchase_option, '')) AND (COALESCE(PL2.offeringclass, '') = COALESCE(cur.pricing_offering_class, '')) AND (cur.pricing_unit = PL2.unit)))
  graviton_elasticache_view:
    parameters:
      data_collection_database_name:
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True   
    dependsOn:
      tags: json
      views:
        - modernization_mapping  
        - graviton_mapping  
      cur2:
      - bill_billing_period_start_date
      - bill_payer_account_id
      - billing_period
      - line_item_line_item_type
      - line_item_resource_id
      - line_item_unblended_cost
      - line_item_usage_account_id
      - line_item_usage_amount
      - line_item_usage_start_date
      - line_item_usage_type
      - pricing_lease_contract_length
      - pricing_offering_class
      - pricing_purchase_option
      - pricing_term
      - pricing_unit
      - product
      - product_instance_type
      - product_location
      - product_product_family
      - reservation_amortized_upfront_fee_for_billing_period
      - reservation_effective_cost
      - reservation_reservation_a_r_n
      - reservation_unused_amortized_upfront_fee_for_billing_period
      - reservation_unused_recurring_fee
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".graviton_elasticache_view AS
      WITH
        elasticache_spend AS (
         SELECT
           bill_payer_account_id
         , line_item_usage_account_id
         , DATE_FORMAT(line_item_usage_start_date, '%Y-%m') month_line_item_usage_start_date
         , SPLIT_PART(line_item_resource_id, ':', 7) split_line_item_resource_id
         , SPLIT_PART(line_item_usage_type, ':', 2) split_line_item_usage_type
         , product_location
         , pricing_term
         , product['cache_engine'] product_cache_engine
         , (CASE WHEN (line_item_line_item_type = 'DiscountedUsage') THEN 'Reserved Instance' WHEN (line_item_line_item_type = 'Usage') THEN 'OnDemand' ELSE 'Others' END) case_purchase_option
         , COALESCE(pricing_lease_contract_length, '') pricing_lease_contract_length
         , COALESCE(pricing_offering_class, '') pricing_offering_class
         , COALESCE(pricing_purchase_option, '') pricing_purchase_option
         , pricing_unit
         , (CASE WHEN (SPLIT_PART(product_instance_type, '.', 2) LIKE '%g%') THEN 'Graviton' ELSE 'Intel' END) processor_type
         , map.generation
         , map.latest_arm graviton_family
         , map.previous_intel previous_intel_family
         , (CASE WHEN (map.latest_arm <> '') THEN CONCAT(map.latest_arm, '.', SPLIT_PART(line_item_usage_type, '.', 3)) ELSE '' END) graviton_instance
         , (CASE WHEN (map.previous_intel <> '') THEN CONCAT(map.previous_intel, '.', SPLIT_PART(line_item_usage_type, '.', 3)) ELSE '' END) previous_intel
         , ${cur_tags_json} tags_json
         , SUM((CASE WHEN (line_item_line_item_type = 'DiscountedUsage') THEN line_item_usage_amount WHEN (line_item_line_item_type = 'Usage') THEN line_item_usage_amount ELSE 0 END)) sum_line_item_usage_amount
         , SUM(line_item_unblended_cost) sum_line_item_unblended_cost
         , SUM((CASE WHEN (line_item_line_item_type = 'DiscountedUsage') THEN reservation_effective_cost WHEN (line_item_line_item_type = 'RIFee') THEN (reservation_unused_amortized_upfront_fee_for_billing_period + reservation_unused_recurring_fee) WHEN ((line_item_line_item_type = 'Fee') AND (reservation_reservation_a_r_n <> '')) THEN 0 ELSE line_item_unblended_cost END)) sum_amortized_cost
         , SUM((CASE WHEN (line_item_line_item_type = 'RIFee') THEN -(reservation_amortized_upfront_fee_for_billing_period) ELSE 0 END)) sum_ri_trueup
         , SUM((CASE WHEN ((line_item_line_item_type = 'Fee') AND (reservation_reservation_a_r_n <> '')) THEN line_item_unblended_cost ELSE 0 END)) ri_upfront_fees
         FROM
           ("${cur2_database}"."${cur2_table_name}"
         LEFT JOIN modernization_mapping map ON (CONCAT('cache.', SPLIT_PART(line_item_usage_type, '.', 2)) = map.family))
         WHERE ((product['product_name'] = 'Amazon ElastiCache') AND (product_product_family = 'Cache Instance') AND (line_item_line_item_type IN ('DiscountedUsage', 'Usage', 'RIFee', 'Fee')) AND (("bill_billing_period_start_date" >= ("date_trunc"('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(concat(split_part("billing_period", '-', 1), '-', split_part("billing_period", '-', 2), '-01') AS date) >= ("date_trunc"('month', current_date) - INTERVAL  '7' MONTH))))
         GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20
      )
      , elasticache_engineversion AS (
         SELECT DISTINCT
           cacheclusterid
         , engineversion
         , engine
         , SPLIT_PART(engineversion, '.', 1) major
         , SPLIT_PART(engineversion, '.', 2) minor
         , SPLIT_PART(engineversion, '.', 3) fix
         FROM
           ${data_collection_database_name}.inventory_elasticache_clusters_data
      )
      , elasticache_pricedata AS (
         SELECT
           'ElastiCache' cache_type
         , od."cache engine"
         , (CASE WHEN (od."storage media" LIKE '%SSD%') THEN 'SSD' ELSE 'Other Storage' END) storage_type
         , (CASE WHEN (od.TermType = 'OnDemand') THEN 'OnDemand' WHEN (od.TermType = 'Reserved') THEN 'Reserved Instance' ELSE od.TermType END) TermType
         , od.location
         , od."instance type"
         , od.purchaseoption
         , od.leasecontractlength
         , od.offeringclass
         , od."storage media"
         , od.priceperunit
         , od.unit
         , (CASE WHEN (od.TermType = 'OnDemand') THEN CAST(od.priceperunit AS double) WHEN (od.TermType = 'Reserved') THEN COALESCE((CAST(od.priceperunit AS double) + (CAST(fee.priceperunit AS double) / ((CAST(RTRIM(fee.leasecontractlength, 'yr') AS int) * 24) * 365))), CAST(od.priceperunit AS double)) ELSE 0 END) odri_priceperunit
         FROM
           (${data_collection_database_name}.pricing_elasticache_data od
         LEFT JOIN ${data_collection_database_name}.pricing_elasticache_data fee ON ((od.sku = fee.sku) AND (od."region code" = fee."region code") AND (fee.purchaseoption = od.purchaseoption) AND (fee.leasecontractlength = od.leasecontractlength) AND (fee.unit = 'Quantity') AND (od.offeringclass = fee.offeringclass)))
         WHERE ((od."location type" = 'AWS Region') AND (od."product family" = 'Cache Instance'))
      )
      SELECT
        elasticache_spend.*
      , ev.engineversion
      , (CASE WHEN (elasticache_spend.product_cache_engine = 'Redis') THEN (CASE WHEN (ev.major >= '5') THEN 'Eligible' WHEN ((ev.major = '5') AND (ev.minor > '0')) THEN 'Eligible' WHEN ((ev.major = '5') AND (ev.minor = '0') AND (ev.fix >= '6')) THEN 'Eligible' ELSE 'Requires Upgrade' END) WHEN (elasticache_spend.product_cache_engine = 'Valkey') THEN (CASE WHEN (ev.major >= '5') THEN 'Eligible' WHEN ((ev.major = '5') AND (ev.minor > '0')) THEN 'Eligible' WHEN ((ev.major = '5') AND (ev.minor = '0') AND (ev.fix >= '6')) THEN 'Eligible' ELSE 'Requires Upgrade' END) WHEN (elasticache_spend.product_cache_engine = 'Memcached') THEN (CASE WHEN (ev.major > '1') THEN 'Eligible' WHEN ((ev.major = '1') AND (ev.minor > '5')) THEN 'Eligible' WHEN ((ev.major = '1') AND (ev.minor = '5') AND (ev.fix >= '16')) THEN 'Eligible' ELSE 'Requires Upgrade' END) ELSE 'Requires Upgrade' END) graviton_eligibility
      , (PL1.odri_priceperunit * elasticache_spend.sum_line_item_usage_amount) graviton_cost
      , (elasticache_spend.sum_amortized_cost - (PL1.odri_priceperunit * elasticache_spend.sum_line_item_usage_amount)) graviton_savings
      , ((PL2.odri_priceperunit * elasticache_spend.sum_line_item_usage_amount) - elasticache_spend.sum_amortized_cost) existing_savings
      , (PL2.odri_priceperunit * elasticache_spend.sum_line_item_usage_amount) intel_equivilant_price
      FROM
        (((elasticache_spend
      LEFT JOIN elasticache_engineversion ev ON (elasticache_spend.split_line_item_resource_id = ev.cacheclusterid))
      LEFT JOIN elasticache_pricedata PL1 ON ((elasticache_spend.graviton_instance = PL1."instance type") AND (elasticache_spend.product_location = PL1.location) AND (elasticache_spend.product_cache_engine = PL1."cache engine") AND (elasticache_spend.case_purchase_option = PL1.TermType) AND (COALESCE(elasticache_spend.pricing_lease_contract_length, '') = COALESCE(PL1.leasecontractlength, '')) AND (COALESCE(elasticache_spend.pricing_purchase_option, '') = COALESCE(PL1.purchaseoption, '')) AND (COALESCE(elasticache_spend.pricing_offering_class, '') = COALESCE(PL1.offeringclass, '')) AND (elasticache_spend.pricing_unit = PL1.unit)))
      LEFT JOIN elasticache_pricedata PL2 ON ((elasticache_spend.previous_intel = PL2."instance type") AND (elasticache_spend.product_location = PL2.location) AND (elasticache_spend.product_cache_engine = PL2."cache engine") AND (elasticache_spend.case_purchase_option = PL2.TermType) AND (COALESCE(elasticache_spend.pricing_lease_contract_length, '') = COALESCE(PL2.leasecontractlength, '')) AND (COALESCE(elasticache_spend.pricing_purchase_option, '') = COALESCE(PL2.purchaseoption, '')) AND (COALESCE(elasticache_spend.pricing_offering_class, '') = COALESCE(PL2.offeringclass, '')) AND (elasticache_spend.pricing_unit = PL2.unit)))
  graviton_mapping:
    parameters:
      data_collection_database_name:
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True   
    dependsOn:
      views: 
        - modernization_mapping
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".graviton_mapping AS
      WITH
        ec2_base_pricing AS (
         SELECT
           od.location
         , od."instance type"
         , od.termtype
         , od.operation
         , od."region code" region_code
         , od.leasecontractlength
         , od.purchaseoption
         , od.offeringclass
         , COALESCE((CAST(od.priceperunit AS double) + (CAST(fee.priceperunit AS double) / ((CAST(RTRIM(fee.leasecontractlength, 'yr') AS int) * 24) * 365))), CAST(od.priceperunit AS double)) effective_priceperunit
         FROM
           (${data_collection_database_name}.pricing_ec2_data od
         LEFT JOIN ${data_collection_database_name}.pricing_ec2_data fee ON ((od.sku = fee.sku) AND (od."region code" = fee."region code") AND (fee.purchaseoption = od.purchaseoption) AND (fee.leasecontractlength = od.leasecontractlength) AND (fee.unit = 'Quantity') AND (od.operation = fee.operation) AND (od.offeringclass = fee.offeringclass)))
         WHERE ((od."license model" = 'No License required') AND (od."capacitystatus" = 'Used') AND (od."unit" = 'Hrs') AND (od."tenancy" = 'Shared') AND (od.ServiceCode = 'AmazonEC2'))
      UNION ALL    SELECT
           sp.location
         , sp."instance type"
         , sp.termtype
         , sp.operation
         , sp.region_code
         , sp.leasecontractlength
         , sp.purchaseoption
         , sp.offeringclass
         , sp.effective_priceperunit
         FROM
           (
            SELECT
              sp.Location
            , sp.DiscountedInstanceType "instance type"
            , 'SavingsPlan' termtype
            , sp.DiscountedOperation operation
            , sp.DIscountedRegionCode region_code
            , concat(sp.leasecontractlength, 'yr') leasecontractlength
            , sp.PurchaseOption purchaseoption
            , sp."product family" offeringclass
            , CAST(sp.DiscountedRate AS double) effective_priceperunit
            , ROW_NUMBER() OVER (PARTITION BY discountedusagetype, usagetype, DiscountedOperation ORDER BY EffectiveDate DESC) rn
            FROM
              ${data_collection_database_name}.pricing_computesavingsplan_data sp
            WHERE ((sp.ServiceCode = 'ComputeSavingsPlans') AND (sp.DiscountedUsageType LIKE '%BoxUsage%') AND (sp.Unit = 'Hrs') AND (sp.LeaseContractLengthUnit = 'year'))
         )  sp
         WHERE (rn = 1)
      )
      , base_instance AS (
         SELECT
           p.*
         , p.effective_priceperunit base_price
         , m.previous_intel prev_intel_family
         , m.latest_arm gn_family
         , m.graviton2 g2_family
         , m.graviton3 g3_family
         , m.graviton4 g4_family
         FROM
           (ec2_base_pricing p
         INNER JOIN modernization_mapping m ON (SPLIT_PART(p."instance type", '.', 1) = m.family))
      )
      , graviton_prices AS (
         SELECT
           b.*
         , t.generation_name
         , CONCAT(NULLIF(family_prefix, ''), '.', SPLIT_PART(b."instance type", '.', 2)) mapped_instance_type
         , p.effective_priceperunit mapped_price
         FROM
           ((base_instance b
         CROSS JOIN UNNEST(ARRAY['prev_intel','graviton_n','graviton2','graviton3','graviton4'], ARRAY[prev_intel_family,gn_family,g2_family,g3_family,g4_family]) t (generation_name, family_prefix))
         LEFT JOIN ec2_base_pricing p ON ((p."instance type" = CONCAT(family_prefix, '.', SPLIT_PART(b."instance type", '.', 2))) AND (p.location = b.location) AND (p.operation = b.operation) AND (p.leasecontractlength = b.leasecontractlength) AND (p.purchaseoption = b.purchaseoption) AND (p.region_code = b.region_code) AND (p.offeringclass = b.offeringclass)))
         WHERE (family_prefix IS NOT NULL)
      )
      , final_price_mapping AS (
         SELECT
           g."instance type" source_instance_type
         , g.location
         , g.termtype
         , g.operation
         , g.region_code
         , g.leasecontractlength
         , g.purchaseoption
         , g.offeringclass
         , g.effective_priceperunit
         , MAX((CASE WHEN (generation_name = 'prev_intel') THEN mapped_instance_type END)) prev_intel_instance_type
         , MAX((CASE WHEN (generation_name = 'prev_intel') THEN mapped_price END)) prev_intel_price
         , MAX((CASE WHEN (generation_name = 'prev_intel') THEN ROUND((((base_price - mapped_price) / base_price) * 100), 2) END)) prev_intel_savings_percentage
         , MAX((CASE WHEN (generation_name = 'graviton_n') THEN mapped_instance_type END)) default_grav_instance_type
         , MAX((CASE WHEN (generation_name = 'graviton_n') THEN mapped_price END)) default_grav_price
         , MAX((CASE WHEN (generation_name = 'graviton_n') THEN ROUND((((base_price - mapped_price) / base_price) * 100), 2) END)) default_grav_savings_percentage
         , MAX((CASE WHEN (generation_name = 'graviton2') THEN mapped_instance_type END)) g2_instance_type
         , MAX((CASE WHEN (generation_name = 'graviton3') THEN mapped_instance_type END)) g3_instance_type
         , MAX((CASE WHEN (generation_name = 'graviton4') THEN mapped_instance_type END)) g4_instance_type
         , MAX((CASE WHEN (generation_name = 'graviton2') THEN mapped_price END)) g2_price
         , MAX((CASE WHEN (generation_name = 'graviton3') THEN mapped_price END)) g3_price
         , MAX((CASE WHEN (generation_name = 'graviton4') THEN mapped_price END)) g4_price
         , MAX((CASE WHEN (generation_name = 'graviton2') THEN ROUND((((base_price - mapped_price) / base_price) * 100), 2) END)) g2_savings_percentage
         , MAX((CASE WHEN (generation_name = 'graviton3') THEN ROUND((((base_price - mapped_price) / base_price) * 100), 2) END)) g3_savings_percentage
         , MAX((CASE WHEN (generation_name = 'graviton4') THEN ROUND((((base_price - mapped_price) / base_price) * 100), 2) END)) g4_savings_percentage
         FROM
           graviton_prices g
         GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9
      )
      SELECT *
      FROM
        final_price_mapping
  graviton_ec2_view:
    parameters:
      data_collection_database_name:
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True   
    dependsOn:
      tags: json
      views:
        - modernization_mapping
        - graviton_mapping
      cur2:
      - bill_billing_period_start_date
      - bill_payer_account_id
      - billing_period
      - line_item_line_item_type
      - line_item_normalized_usage_amount
      - line_item_operation
      - line_item_product_code
      - line_item_unblended_cost
      - line_item_usage_account_id
      - line_item_usage_amount
      - line_item_usage_start_date
      - line_item_usage_type
      - pricing_lease_contract_length
      - pricing_offering_class
      - pricing_purchase_option
      - product
      - product_instance_type
      - product_location
      - reservation_effective_cost
      - reservation_reservation_a_r_n
      - reservation_unused_amortized_upfront_fee_for_billing_period
      - reservation_unused_recurring_fee
      - savings_plan_offering_type
      - savings_plan_payment_option
      - savings_plan_purchase_term
      - savings_plan_savings_plan_a_r_n
      - savings_plan_savings_plan_effective_cost
      - savings_plan_total_commitment_to_date
      - savings_plan_used_commitment
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".graviton_ec2_view AS
      WITH
        summary_view AS (
         SELECT
           "bill_billing_period_start_date" "billing_period"
         , DATE_FORMAT(line_item_usage_start_date, '%Y-%m-%d') "usage_date"
         , bill_payer_account_id "payer_account_id"
         , line_item_usage_account_id "linked_account_id"
         , product_instance_type existing_instance
         , line_item_line_item_type "charge_type"
         , (CASE WHEN (savings_plan_savings_plan_a_r_n <> '') THEN 'SavingsPlan' WHEN (reservation_reservation_a_r_n <> '') THEN 'Reserved' WHEN (line_item_usage_type LIKE '%Spot%') THEN 'Spot' ELSE 'OnDemand' END) "purchase_option"
         , product['region'] "region"
         , (CASE WHEN (savings_plan_offering_type = 'ComputeSavingsPlans') THEN 'Any' ELSE product_location END) "location"
         , product['operating_system'] "product_operating_system"
         , line_item_operation
         , (CASE WHEN (product['physical_processor'] LIKE '%Intel%') THEN 'Intel' WHEN (product['physical_processor'] LIKE '%AMD%') THEN 'AMD' WHEN (product['physical_processor'] LIKE '%Graviton%') THEN 'Graviton' ELSE product['physical_processor'] END) processor_type
         , product['instance_type_family'] "product_instance_type_family"
         , split_part(product_instance_type, '.', 2) size
         , (CASE WHEN (pricing_lease_contract_length <> '') THEN pricing_lease_contract_length ELSE savings_plan_purchase_term END) contract_length
         , COALESCE((CASE WHEN (COALESCE(pricing_offering_class, '') <> '') THEN COALESCE(pricing_offering_class, '') ELSE savings_plan_offering_type END), '') offering_type
         , (CASE WHEN (COALESCE(pricing_offering_class, '') <> '') THEN COALESCE(pricing_offering_class, '') WHEN (savings_plan_offering_type = 'ComputeSavingsPlans') THEN 'convertible' WHEN (savings_plan_offering_type = 'EC2InstanceSavingsPlans') THEN 'standard' END) offering_type_mapping_only_column
         , (CASE WHEN (pricing_purchase_option <> '') THEN pricing_purchase_option ELSE savings_plan_payment_option END) payment_option
         , ${cur_tags_json} tags_json
         , sum((CASE WHEN (line_item_line_item_type = 'SavingsPlanCoveredUsage') THEN line_item_usage_amount WHEN (line_item_line_item_type = 'DiscountedUsage') THEN line_item_usage_amount WHEN (line_item_line_item_type = 'Usage') THEN line_item_usage_amount ELSE 0 END)) "usage_quantity"
         , sum((CASE WHEN (line_item_line_item_type = 'SavingsPlanCoveredUsage') THEN line_item_normalized_usage_amount WHEN (line_item_line_item_type = 'DiscountedUsage') THEN line_item_normalized_usage_amount WHEN (line_item_line_item_type = 'Usage') THEN line_item_normalized_usage_amount ELSE 0 END)) "normalized_usage_quantity"
         , sum(line_item_unblended_cost) "unblended_cost"
         , sum((CASE WHEN (line_item_line_item_type = 'SavingsPlanCoveredUsage') THEN savings_plan_savings_plan_effective_cost WHEN (line_item_line_item_type = 'SavingsPlanRecurringFee') THEN (savings_plan_total_commitment_to_date - savings_plan_used_commitment) WHEN (line_item_line_item_type = 'SavingsPlanNegation') THEN 0 WHEN (line_item_line_item_type = 'SavingsPlanUpfrontFee') THEN 0 WHEN (line_item_line_item_type = 'DiscountedUsage') THEN reservation_effective_cost WHEN (line_item_line_item_type = 'RIFee') THEN (reservation_unused_amortized_upfront_fee_for_billing_period + reservation_unused_recurring_fee) WHEN ((line_item_line_item_type = 'Fee') AND (reservation_reservation_a_r_n <> '')) THEN 0 ELSE line_item_unblended_cost END)) "amortized_cost"
         FROM
           "${cur2_database}"."${cur2_table_name}" cur
         WHERE (((((line_item_product_code = 'AmazonEC2') AND ((line_item_usage_type LIKE '%BoxUsage%') OR (line_item_usage_type LIKE '%Spot%'))) AND (line_item_line_item_type <> 'SavingsPlanNegation')) AND ((bill_billing_period_start_date >= (date_trunc('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(concat(split_part("billing_period", '-', 1), '-', split_part("billing_period", '-', 2), '-01') AS date) >= (date_trunc('month', current_date) - INTERVAL  '7' MONTH)))) AND (line_item_line_item_type IN ('DiscountedUsage', 'Usage', 'Fee', 'RIFee', 'SavingsPlanCoveredUsage')))
         GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19
      )
      , summary_view_final AS (
         SELECT
           summary_view.*
         , (CASE WHEN (price_map.default_grav_instance_type <> '') THEN 'Available' ELSE '*Unavailable' END) graviton_instance_exists
         , (CASE WHEN (summary_view.processor_type = 'Graviton') THEN 'Already Graviton' WHEN (summary_view.product_operating_system = 'Windows') THEN 'Windows Usage' WHEN (summary_view.purchase_option = 'Reserved') THEN 'Reserved Instance Covered Usage' WHEN (summary_view.purchase_option = 'Spot') THEN 'Spot Usage' WHEN (COALESCE(price_map.default_grav_price, 0) = 0) THEN 'No equivalent graviton instance' WHEN (offering_type = 'EC2InstanceSavingsPlans') THEN 'Instance Savings Plan Covered Usage' ELSE 'Eligible' END) ineligibility_reason
         , prev_intel_instance_type previous_intel_instance
         , prev_intel_price previous_intel_rate
         , (CAST(prev_intel_price AS double) * summary_view.usage_quantity) previous_intel_price
         , prev_intel_savings_percentage
         , (CASE WHEN (NOT (summary_view.processor_type = 'Graviton')) THEN default_grav_instance_type ELSE ' ' END) graviton_instance
         , (CASE WHEN (NOT (summary_view.processor_type = 'Graviton')) THEN default_grav_price ELSE 0 END) graviton_rate
         , (CASE WHEN (NOT (summary_view.processor_type = 'Graviton')) THEN (CAST(default_grav_price AS double) * summary_view.usage_quantity) ELSE 0 END) graviton_price
         , default_grav_instance_type
         , default_grav_price
         , (CAST(default_grav_price AS double) * summary_view.usage_quantity) default_grav_amortized_cost
         , default_grav_savings_percentage
         , g2_instance_type
         , g2_price
         , (CAST(g2_price AS double) * summary_view.usage_quantity) g2_amortized_cost
         , g2_savings_percentage
         , g3_instance_type
         , g3_price
         , (CAST(g3_price AS double) * summary_view.usage_quantity) g3_amortized_cost
         , g3_savings_percentage
         , g4_instance_type
         , g4_price
         , (CAST(g4_price AS double) * summary_view.usage_quantity) g4_amortized_cost
         , g4_savings_percentage
         FROM
           (summary_view
         LEFT JOIN graviton_mapping price_map ON ((price_map.location = summary_view.location) AND (price_map.region_code = summary_view.region) AND (price_map.source_instance_type = summary_view.existing_instance) AND (price_map.operation = summary_view.line_item_operation) AND (price_map.leasecontractlength = summary_view.contract_length) AND (price_map.purchaseoption = summary_view.payment_option) AND (price_map.offeringclass = summary_view.offering_type)))
         WHERE (purchase_option IN ('Reserved', 'SavingsPlan', 'Spot', 'OnDemand'))
      )
      SELECT
        fi.*
      , (amortized_cost - graviton_price) "graviton_savings_potential"
      , (amortized_cost - default_grav_amortized_cost) "default_g_savings_potential"
      , (amortized_cost - g2_amortized_cost) "g2_savings_potential"
      , (amortized_cost - g3_amortized_cost) "g3_savings_potential"
      , (amortized_cost - g4_amortized_cost) "g4_savings_potential"
      FROM
        summary_view_final fi
  graviton_rds_view:
    parameters:
      data_collection_database_name:
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True
    dependsOn:
      tags: json
      views:
        - modernization_mapping  
        - graviton_mapping  
      cur2:
      - bill_billing_period_start_date
      - bill_payer_account_id
      - billing_period
      - line_item_availability_zone
      - line_item_line_item_type
      - line_item_resource_id
      - line_item_unblended_cost
      - line_item_unblended_rate
      - line_item_usage_account_id
      - line_item_usage_amount
      - pricing_lease_contract_length
      - pricing_public_on_demand_rate
      - pricing_purchase_option
      - pricing_term
      - pricing_unit
      - product
      - product_instance_type
      - product_location
      - product_product_family
      - reservation_effective_cost
      - reservation_reservation_a_r_n
      - reservation_unused_amortized_upfront_fee_for_billing_period
      - reservation_unused_recurring_fee
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".graviton_rds_view AS
      WITH
        cur_data AS (
         SELECT
           bill_payer_account_id
         , line_item_usage_account_id
         , bill_billing_period_start_date
         , product_instance_type
         , product['storage'] product_storage
         , pricing_term
         , COALESCE(pricing_lease_contract_length, '') pricing_lease_contract_length
         , COALESCE(pricing_purchase_option, '') pricing_purchase_option
         , pricing_unit
         , SPLIT_PART(line_item_resource_id, ':', 7) line_item_resource_id
         , (CASE WHEN (product['storage'] LIKE 'EBS Only') THEN 'EBS Only' WHEN (product['storage'] LIKE 'Aurora IO Optimization Mode') THEN 'Aurora IO Optimization Mode' WHEN (product['storage'] LIKE '%SSD%') THEN 'SSD' ELSE 'Other Storage' END) product_storage_type
         , (CASE WHEN (product['database_engine'] LIKE 'Aurora%') THEN 'Aurora' ELSE 'AmazonRDS' END) rds_type
         , (CASE WHEN (product['database_engine'] LIKE 'Aurora%') THEN SPLIT_PART(product['database_engine'], ' ', 2) ELSE product['database_engine'] END) db_engine
         , line_item_availability_zone
         , product_location
         , lower(product['instance_type_family']) "product_instance_type_family"
         , (CASE WHEN (product['physical_processor'] LIKE '%Intel%') THEN 'Intel' WHEN (product['physical_processor'] LIKE '%AMD%') THEN 'AMD' WHEN (product['physical_processor'] LIKE '%Graviton%') THEN 'Graviton' ELSE product['physical_processor'] END) processor_type
         , product['deployment_option'] product_deployment_option
         , line_item_unblended_rate
         , pricing_public_on_demand_rate
         , map.generation
         , map.latest_arm
         , (CASE WHEN (map.latest_arm <> '') THEN CONCAT('db.', map.latest_arm, '.', SPLIT_PART(product_instance_type, '.', 3)) ELSE '' END) graviton_instance_type
         , (CASE WHEN (map.previous_intel <> '') THEN CONCAT('db.', map.previous_intel, '.', SPLIT_PART(product_instance_type, '.', 3)) ELSE '' END) latest_intel_instance_type
         , ${cur_tags_json} tags_json
         , SUM((CASE WHEN (line_item_line_item_type = 'DiscountedUsage') THEN line_item_usage_amount WHEN (line_item_line_item_type = 'Usage') THEN line_item_usage_amount ELSE 0 END)) line_item_usage_amount
         , SUM(line_item_unblended_cost) line_item_unblended_cost
         , SUM((CASE WHEN (line_item_line_item_type = 'DiscountedUsage') THEN reservation_effective_cost WHEN (line_item_line_item_type = 'RIFee') THEN (reservation_unused_amortized_upfront_fee_for_billing_period + reservation_unused_recurring_fee) WHEN ((line_item_line_item_type = 'Fee') AND (reservation_reservation_a_r_n <> '')) THEN 0 ELSE line_item_unblended_cost END)) sum_amortized_cost
         FROM
           ("${cur2_database}"."${cur2_table_name}"
         LEFT JOIN modernization_mapping map ON (lower(product['instance_type_family']) = map.family))
         WHERE (((product['product_name'] = 'Amazon Relational Database Service') AND (line_item_line_item_type IN ('DiscountedUsage', 'Usage', 'Fee', 'RIFee')) AND (product_product_family = 'Database Instance')) AND (("bill_billing_period_start_date" >= ("date_trunc"('month', current_timestamp) - INTERVAL  '7' MONTH)) AND (CAST(concat(split_part("billing_period", '-', 1), '-', split_part("billing_period", '-', 2), '-01') AS date) >= ("date_trunc"('month', current_date) - INTERVAL  '7' MONTH))))
         GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25
      )
      , describe_db_data AS (
         SELECT DISTINCT
           dbinstanceidentifier
         , accountid
         , dbinstanceclass
         , "concat"("split_part"(dbinstanceclass, '.', 1), '.', "split_part"(dbinstanceclass, '.', 2)) instance_family
         , availabilityzone
         , "rtrim"(availabilityzone, 'abcdef') region
         , (CASE WHEN (CAST(multiaz AS VARCHAR) = 'false') THEN 'Single-AZ' WHEN (CAST(multiaz AS VARCHAR) = 'true') THEN 'Multi-AZ' ELSE 'Error check deployment option' END) "deployment option"
         , (CASE WHEN (engine LIKE 'aurora%') THEN 'Aurora' ELSE 'AmazonRDS' END) rds_type
         , engine
         , (CASE WHEN (engine LIKE '%postgres%') THEN 'PostgreSQL' WHEN (engine LIKE '%mysql%') THEN 'MySQL' WHEN (engine LIKE '%mariadb%') THEN 'MariaDB' WHEN (engine LIKE '%oracle%') THEN 'Oracle' WHEN (engine LIKE '%docdb%') THEN 'DocDB' WHEN (engine LIKE '%sqlserver%') THEN 'SQL Server' WHEN (engine LIKE 'aurora 5.6.10a') THEN 'aurora 5.6.10a' WHEN (engine LIKE '%neptune%') THEN 'Neptune' ELSE 'Check DB Engine' END) db_engine
         , MAX((CASE WHEN (engineversion LIKE '%aurora%') THEN "concat"("split_part"("substr"(engineversion, 18, 6), '.', 1), '.', "split_part"("substr"(engineversion, 18, 6), '.', 2), '.', "split_part"("substr"(engineversion, 18, 6), '.', 3)) ELSE engineversion END)) engineversion
         FROM
           ${data_collection_database_name}.inventory_rds_db_instances_data
         GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
      )
      , engine_logic AS (
         SELECT
           *
         , (CASE WHEN (engineversion LIKE '%aurora%') THEN "split_part"("substr"(engineversion, 18, 6), '.', 1) ELSE "split_part"(engineversion, '.', 1) END) major
         , (CASE WHEN (engineversion LIKE '%aurora%') THEN "split_part"("substr"(engineversion, 18, 6), '.', 2) ELSE "split_part"(engineversion, '.', 2) END) minor
         , (CASE WHEN (engineversion LIKE '%aurora%') THEN "split_part"("substr"(engineversion, 18, 6), '.', 3) ELSE "split_part"(engineversion, '.', 3) END) fix
         FROM
           describe_db_data
      )
      , rds_pricedata AS (
         SELECT
           (CASE WHEN (od."database engine" LIKE 'Aurora%') THEN 'Aurora' WHEN (od."database engine" = 'Any') THEN 'Any' ELSE 'AmazonRDS' END) rds_type
         , (CASE WHEN (od."database engine" LIKE 'Aurora%') THEN "split_part"(od."database engine", ' ', 2) ELSE od."database engine" END) db_engine
         , (CASE WHEN (od.storage LIKE 'EBS Only') THEN 'EBS Only' WHEN (od.storage LIKE 'Aurora IO Optimization Mode') THEN 'Aurora IO Optimization Mode' WHEN (od.storage LIKE '%SSD%') THEN 'SSD' ELSE 'Other Storage' END) storage_type
         , od.TermType
         , od."deployment option"
         , od.location
         , od."instance type"
         , od.purchaseoption
         , od.leasecontractlength
         , od.offeringclass
         , od.storage
         , od.priceperunit
         , od.unit
         , (CASE WHEN (od.TermType LIKE 'OnDemand') THEN CAST(od.priceperunit AS double) WHEN (od.TermType LIKE 'Reserved') THEN COALESCE((CAST(od.priceperunit AS double) + (CAST(fee.priceperunit AS double) / ((CAST(rtrim(fee.leasecontractlength, 'yr') AS int) * 24) * 365))), CAST(od.priceperunit AS double)) ELSE 0 END) odri_priceperunit
         FROM
           (${data_collection_database_name}.pricing_rds_data od
         LEFT JOIN ${data_collection_database_name}.pricing_rds_data fee ON ((od.sku = fee.sku) AND (od."region code" = fee."region code") AND (fee.purchaseoption = od.purchaseoption) AND (fee.leasecontractlength = od.leasecontractlength) AND (fee.unit = 'Quantity') AND (od.operation = fee.operation) AND (od.offeringclass = fee.offeringclass)))
         WHERE ((od."location type" = 'AWS Region') AND (od."product family" = 'Database Instance'))
      )
      SELECT
        cur_data.*
      , describe_db_data.engineversion
      , (CASE WHEN (cur_data.product_instance_type LIKE '%g.%') THEN 'Already Graviton' WHEN (cur_data.product_instance_type LIKE '%gd.%') THEN 'Already Graviton' WHEN (cur_data.product_instance_type LIKE '%serverless%') THEN 'Ineligible' ELSE (CASE WHEN (cur_data.rds_type = 'AmazonRDS') THEN (CASE WHEN (cur_data.db_engine = 'MySQL') THEN (CASE WHEN (CAST(engine_logic.major AS integer) > 8) THEN 'Eligible' WHEN ((CAST(engine_logic.major AS integer) = 8) AND (CAST(engine_logic.minor AS integer) > 0)) THEN 'Eligible' WHEN (((CAST(engine_logic.major AS integer) = 8) AND (CAST(engine_logic.minor AS integer) = 0)) AND (CAST(engine_logic.fix AS integer) >= 17)) THEN 'Eligible' ELSE 'Requires Update' END) WHEN (cur_data.db_engine = 'PostgreSQL') THEN (CASE WHEN (CAST(engine_logic.major AS integer) > 12) THEN 'Eligible' WHEN ((CAST(engine_logic.major AS integer) = 12) AND (CAST(engine_logic.minor AS integer) >= 3)) THEN 'Eligible' ELSE 'Requires Update' END) WHEN (cur_data.db_engine = 'MariaDB') THEN (CASE WHEN (CAST(engine_logic.major AS integer) > 10) THEN 'Eligible' WHEN ((CAST(engine_logic.major AS integer) = 10) AND (CAST(engine_logic.minor AS integer) > 4)) THEN 'Eligible' WHEN (((CAST(engine_logic.major AS integer) = 10) AND (CAST(engine_logic.minor AS integer) = 4)) AND (CAST(engine_logic.fix AS integer) >= 13)) THEN 'Eligible' ELSE 'Requires Update' END) ELSE 'Ineligible' END) WHEN (cur_data.rds_type = 'Aurora') THEN (CASE WHEN (cur_data.db_engine = 'MySQL') THEN (CASE WHEN (CAST(engine_logic.major AS integer) > 2) THEN 'Eligible' WHEN ((CAST(engine_logic.major AS integer) = 2) AND (CAST(engine_logic.minor AS integer) > 9)) THEN 'Eligible' WHEN (((CAST(engine_logic.major AS integer) = 2) AND (CAST(engine_logic.minor AS integer) = 9)) AND (CAST(engine_logic.fix AS integer) >= 2)) THEN 'Eligible' ELSE 'Ineligible' END) WHEN (cur_data.db_engine = 'PostgreSQL') THEN (CASE WHEN (CAST(engine_logic.major AS integer) > 12) THEN 'Eligible' WHEN ((CAST(engine_logic.major AS integer) = 12) AND (CAST(engine_logic.minor AS integer) >= 3)) THEN 'Eligible' WHEN ((CAST(engine_logic.major AS integer) = 11) AND (CAST(engine_logic.minor AS integer) >= 9)) THEN 'Eligible' ELSE 'Ineligible' END) ELSE 'Ineligible' END) END) END) graviton_eligible
      , PL1.storage storage
      , PL2.storage new_intel_storage
      , PL1.storage_type storage_type
      , CAST(PL1.odri_priceperunit AS double) graviton_unit_cost
      , (CAST(PL1.odri_priceperunit AS double) * cur_data.line_item_usage_amount) graviton_cost
      , (cur_data.sum_amortized_cost - (CAST(PL1.odri_priceperunit AS double) * cur_data.line_item_usage_amount)) graviton_unblended_savings
      , CAST(PL2.odri_priceperunit AS double) previous_intel_unit_cost
      , (CAST(PL2.odri_priceperunit AS double) * cur_data.line_item_usage_amount) previous_intel_cost
      , ((CAST(PL2.odri_priceperunit AS double) * cur_data.line_item_usage_amount) - cur_data.line_item_unblended_cost) previous_intel_unblended_savings
      FROM
        ((((cur_data
      LEFT JOIN describe_db_data ON ((cur_data.line_item_resource_id = describe_db_data.dbinstanceidentifier) AND (cur_data.line_item_usage_account_id = describe_db_data.accountid) AND (cur_data.line_item_availability_zone = describe_db_data.region)))
      LEFT JOIN engine_logic ON ((cur_data.line_item_resource_id = engine_logic.dbinstanceidentifier) AND (cur_data.line_item_usage_account_id = engine_logic.accountid)))
      LEFT JOIN rds_pricedata PL1 ON ((cur_data.rds_type = PL1.rds_type) AND (cur_data.db_engine = PL1.db_engine) AND (cur_data.pricing_lease_contract_length = PL1.leasecontractlength) AND (cur_data.pricing_purchase_option = PL1.purchaseoption) AND (cur_data.product_deployment_option = PL1."deployment option") AND (cur_data.product_location = PL1.location) AND (cur_data.graviton_instance_type = PL1."instance type") AND (cur_data.product_storage_type = PL1.storage_type) AND (cur_data.pricing_unit = PL1.unit) AND (PL1.termtype = cur_data.pricing_term)))
      LEFT JOIN rds_pricedata PL2 ON ((cur_data.rds_type = PL2.rds_type) AND (cur_data.db_engine = PL2.db_engine) AND (cur_data.pricing_lease_contract_length = PL2.leasecontractlength) AND (cur_data.pricing_purchase_option = PL2.purchaseoption) AND (cur_data.product_deployment_option = PL2."deployment option") AND (cur_data.product_location = PL2.location) AND (cur_data.latest_intel_instance_type = PL2."instance type") AND (cur_data.product_storage_type = PL2.storage_type) AND (cur_data.pricing_unit = PL2.unit) AND (PL2.termtype = cur_data.pricing_term)))
  modernization_mapping:
    data: |-
      CREATE OR REPLACE VIEW "modernization_mapping" AS 
        SELECT
          family
        , generation
        , latest_intel
        , latest_amd
        , latest_arm
        , previous_intel
        , CAST(latest_elasticsearch_intel AS VARCHAR(255)) latest_elasticsearch_intel
        , graviton2
        , graviton3
        , graviton4
        FROM
          (
        VALUES 
          -- EC2 Instances - Original Families
            ROW ('a1', 'Graviton', '', '', 'c6g', 'c4', '', 'a1', '', '')
          , ROW ('c1', 'Previous', 'c6i', 'c6a', 'c7g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c3', 'Previous', 'c6i', 'c6a', 'c7g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c4', 'Preceding', 'c6i', 'c6a', 'c7g', 'c5', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c5', 'Preceding', 'c6i', 'c6a', 'c6g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c5a', 'Preceding', '', 'c6a', 'c6g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c5ad', 'Latest', '', '', 'c6gd', '', '', 'c6gd', 'c7gd', '')
          , ROW ('c5d', 'Preceding', 'c6id', 'c5ad', 'c6gd', '', '', 'c6gd', 'c7gd', '')
          , ROW ('c5n', 'Latest', '', '', 'c6gn', '', '', 'c6gn', 'c7gn', '')
          , ROW ('c6a', 'Latest', '', '', 'c7g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c6g', 'Graviton2', '', '', 'c7g', 'c5', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c6gd', 'Graviton2', '', '', 'c7gd', 'c5d', '', 'c6gd', 'c7gd', '')
          , ROW ('c6gn', 'Graviton2', '', '', 'c7gn', 'c5n', '', 'c6gn', 'c7gn', '')
          , ROW ('c6i', 'Latest', '', '', 'c7g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c6id', 'Latest', '', '', 'c7gd', '', '', 'c6gd', 'c7gd', 'c8g')
          , ROW ('c6in', 'Latest', '', '', 'c7gn', '', '', 'c6gn', 'c7gn', 'c8g')
          , ROW ('c7g', 'Graviton3', 'c6i', '', 'c8g', 'c6i', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c7gd', 'Graviton3', '', '', 'c8g', 'c6id', '', 'c6gd', 'c7gd', 'c8g')
          , ROW ('c7gn', 'Graviton3', '', '', 'c8g', 'c6in', '', 'c6gn', 'c7gn', 'c8g')
          , ROW ('c7i', 'Latest', '', '', 'c8g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c8g', 'Graviton4', '', '', 'c8g', 'c7i', '', 'c6g', 'c7g', 'c8g')
          , ROW ('g4ad', 'Preceding', '', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g4dn', 'Preceding', '', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g5', 'Latest', '', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g5g', 'Graviton2', '', '', 'g5g', 'g4dn', '', 'g5g', '', '')
          , ROW ('i3', 'Previous', 'i4i', '', 'i4g', '', '', '', 'i4g', '')
          , ROW ('i3en', 'Latest', '', '', 'i4g', '', '', '', 'i4g', '')
          , ROW ('i4g', 'Graviton3', '', '', 'i4g', 'i3', '', '', 'i4g', '')
          , ROW ('im4gn', 'Graviton2', '', '', 'im4gn', '', '', 'im4gn', '', '')
          , ROW ('is4gen', 'Graviton2', '', '', 'is4gen', '', '', 'is4gen', '', '')
          , ROW ('m1', 'Previous', 'm6i', 'm6a', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m2', 'Previous', 'm6i', 'm6a', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m3', 'Previous', 'm6i', 'm6a', 'm7g', 'm4', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m4', 'Preceding', 'm6i', 'm6a', 'm7g', 'm5', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m5', 'Preceding', 'm6i', 'm6a', 'm6g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m5a', 'Preceding', '', 'm6a', 'm6g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m5ad', 'Latest', '', '', 'm6gd', '', '', 'm6gd', '', '')
          , ROW ('m5d', 'Preceding', 'm6id', 'm6a', 'm6gd', '', '', 'm6gd', '', '')
          , ROW ('m6a', 'Latest', '', '', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m6g', 'Graviton2', '', '', 'm7g', 'm5', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m6gd', 'Graviton2', '', '', 'm7g', 'm5d', '', 'm6gd', '', '')
          , ROW ('m6i', 'Latest', '', '', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m6id', 'Latest', '', '', 'm7g', '', '', 'm6gd', 'm7g', 'm8g')
          , ROW ('m7g', 'Graviton3', '', '', 'm8g', 'm6i', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m7i', 'Latest', '', '', 'm8g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m8g', 'Graviton4', '', '', 'm8g', 'm7i', '', 'm6g', 'm7g', 'm8g')
          , ROW ('r3', 'Previous', 'r6i', 'r6a', 'r7g', 'r5', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r4', 'Preceding', 'r6i', 'r6a', 'r7g', 'r5', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r5', 'Preceding', 'r6i', 'r6a', 'r6g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r5a', 'Preceding', '', 'r6a', 'r6g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r5ad', 'Latest', '', '', 'r6gd', '', '', 'r6gd', '', '')
          , ROW ('r5d', 'Preceding', 'r6id', 'r5ad', 'r6gd', '', '', 'r6gd', '', '')
          , ROW ('r6a', 'Latest', '', '', 'r7g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r6g', 'Graviton2', 'r7i', '', 'r7g', 'r5', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r6gd', 'Graviton2', '', '', 'r7g', 'r5d', '', 'r6gd', '', '')
          , ROW ('r6i', 'Latest', '', '', 'r7g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r6id', 'Latest', '', '', 'r7g', '', '', 'r6gd', '', '')
          , ROW ('r7g', 'Graviton3', 'r6i', '', 'r8g', 'r6i', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r7i', 'Latest', '', '', 'r8g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r8g', 'Graviton4', '', '', 'r8g', 'r7i', '', 'r6g', 'r7g', 'r8g')
          , ROW ('t1', 'Previous', 't3', 't3a', 't4g', 't3', '', 't4g', '', '')
          , ROW ('t2', 'Preceding', 't3', 't3a', 't4g', 't3', '', 't4g', '', '')
          , ROW ('t3', 'Latest', '', '', 't4g', '', '', 't4g', '', '')
          , ROW ('t3a', 'Latest', '', '', 't4g', '', '', 't4g', '', '')
          , ROW ('t4g', 'Graviton2', '', '', 't4g', 't3', '', 't4g', '', '')
          , ROW ('x1', 'Latest', '', '', 'x2gd', '', '', 'x2gd', '', '')
          , ROW ('x1e', 'Latest', '', '', 'x2gd', '', '', 'x2gd', '', '')
          , ROW ('x2gd', 'Graviton2', '', '', 'x2gd', 'x1', '', 'x2gd', '', '')
          -- EC2 Instances - New Families Added October 2025
          , ROW ('c7a', 'Latest', '', 'c7a', 'c7g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c7i-flex', 'Latest', 'c7i-flex', '', 'c8g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c8gd', 'Graviton4', '', '', 'c8gd', 'c7i', '', 'c6gd', 'c7gd', 'c8gd')
          , ROW ('c8gn', 'Graviton4', '', '', 'c8gn', 'c7i', '', 'c6gn', 'c7gn', 'c8gn')
          , ROW ('c8i', 'Latest', 'c8i', '', 'c8g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('c8i-flex', 'Latest', 'c8i-flex', '', 'c8g', '', '', 'c6g', 'c7g', 'c8g')
          , ROW ('cc', 'Previous', 'c6i', '', '', '', '', '', '', '')
          , ROW ('cc1', 'Previous', 'c6i', '', '', '', '', '', '', '')
          , ROW ('cc2', 'Previous', 'c6i', '', '', '', '', '', '', '')
          , ROW ('cg1', 'Previous', 'g5', '', '', '', '', '', '', '')
          , ROW ('cr', 'Previous', '', '', '', '', '', '', '', '')
          , ROW ('cr1', 'Previous', '', '', '', '', '', '', '', '')
          , ROW ('d2', 'Previous', '', '', '', '', '', '', '', '')
          , ROW ('d3', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('d3en', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('dl1', 'Latest', 'dl2q', '', '', '', '', '', '', '')
          , ROW ('dl2q', 'Latest', 'dl2q', '', '', '', '', '', '', '')
          , ROW ('f1', 'Latest', 'f2', '', '', '', '', '', '', '')
          , ROW ('f2', 'Latest', 'f2', '', '', '', '', '', '', '')
          , ROW ('g2', 'Previous', 'g5', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g3', 'Previous', 'g5', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g3s', 'Previous', 'g5', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g6', 'Latest', 'g6', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g6e', 'Latest', 'g6e', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('g6f', 'Latest', 'g6f', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('gr6', 'Latest', 'gr6', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('gr6f', 'Latest', 'gr6f', '', 'g5g', '', '', 'g5g', '', '')
          , ROW ('hpc6a', 'Latest', '', 'hpc7a', 'hpc7g', '', '', '', 'hpc7g', '')
          , ROW ('hpc6id', 'Latest', 'hpc7a', 'hpc7a', 'hpc7g', '', '', '', 'hpc7g', '')
          , ROW ('hpc7a', 'Latest', '', 'hpc7a', 'hpc7g', '', '', '', 'hpc7g', '')
          , ROW ('hpc7g', 'Graviton3', '', '', 'hpc7g', 'hpc6a', '', '', 'hpc7g', '')
          , ROW ('i2', 'Previous', 'i4i', '', 'i4g', 'i3', '', '', 'i4g', '')
          , ROW ('i4i', 'Latest', 'i4i', '', 'i4g', '', '', '', 'i4g', '')
          , ROW ('i7i', 'Latest', 'i7i', '', 'i8g', '', '', '', 'i4g', 'i8g')
          , ROW ('i7ie', 'Latest', 'i7ie', '', 'i8ge', '', '', '', 'i4g', 'i8ge')
          , ROW ('i8g', 'Graviton4', '', '', 'i8g', 'i7i', '', '', 'i4g', 'i8g')
          , ROW ('i8ge', 'Graviton4', '', '', 'i8ge', 'i7ie', '', '', 'i4g', 'i8ge')
          , ROW ('inf1', 'Latest', 'inf2', '', '', '', '', '', '', '')
          , ROW ('inf2', 'Latest', 'inf2', '', '', '', '', '', '', '')
          , ROW ('m5dn', 'Latest', 'm6idn', 'm6a', 'm6gd', '', '', 'm6gd', 'm7g', 'm8g')
          , ROW ('m5n', 'Latest', 'm6in', 'm6a', 'm6g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m5zn', 'Latest', 'm7i', 'm7a', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m6idn', 'Latest', 'm6idn', '', 'm7gd', '', '', 'm6gd', 'm7gd', 'm8gd')
          , ROW ('m6in', 'Latest', 'm6in', '', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m7a', 'Latest', '', 'm7a', 'm7g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m7gd', 'Graviton3', '', '', 'm8gd', 'm6id', '', 'm6gd', 'm7gd', 'm8gd')
          , ROW ('m7i-flex', 'Latest', 'm7i-flex', '', 'm8g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m8a', 'Latest', '', 'm8a', 'm8g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m8gd', 'Graviton4', '', '', 'm8gd', 'm7i', '', 'm6gd', 'm7gd', 'm8gd')
          , ROW ('m8i', 'Latest', 'm8i', '', 'm8g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('m8i-flex', 'Latest', 'm8i-flex', '', 'm8g', '', '', 'm6g', 'm7g', 'm8g')
          , ROW ('mac-m4', 'Latest', 'mac-m4', '', '', '', '', '', '', '')
          , ROW ('mac-m4pro', 'Latest', 'mac-m4pro', '', '', '', '', '', '', '')
          , ROW ('mac1', 'Latest', 'mac2', '', '', '', '', '', '', '')
          , ROW ('mac2', 'Latest', 'mac2', '', '', '', '', '', '', '')
          , ROW ('mac2-m1ultra', 'Latest', 'mac2-m1ultra', '', '', '', '', '', '', '')
          , ROW ('mac2-m2', 'Latest', 'mac2-m2', '', '', '', '', '', '', '')
          , ROW ('mac2-m2pro', 'Latest', 'mac2-m2pro', '', '', '', '', '', '', '')
          , ROW ('p2', 'Previous', 'p5', '', '', 'p3', '', '', '', '')
          , ROW ('p3', 'Previous', 'p5', '', '', 'p4d', '', '', '', '')
          , ROW ('p3dn', 'Latest', 'p5', '', '', '', '', '', '', '')
          , ROW ('p4d', 'Latest', 'p5', '', '', '', '', '', '', '')
          , ROW ('p5', 'Latest', 'p5', '', '', '', '', '', '', '')
          , ROW ('p5e', 'Latest', 'p5e', '', '', '', '', '', '', '')
          , ROW ('p5en', 'Latest', 'p5en', '', '', '', '', '', '', '')
          , ROW ('p6-b200', 'Latest', 'p6-b200', '', '', '', '', '', '', '')
          , ROW ('r5b', 'Latest', 'r6i', 'r6a', 'r7g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r5dn', 'Latest', 'r6idn', 'r6a', 'r6gd', '', '', 'r6gd', 'r7g', 'r8g')
          , ROW ('r5n', 'Latest', 'r6in', 'r6a', 'r6g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r6idn', 'Latest', 'r6idn', '', 'r7gd', '', '', 'r6gd', 'r7gd', 'r8gd')
          , ROW ('r6in', 'Latest', 'r6in', '', 'r7g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r7a', 'Latest', '', 'r7a', 'r7g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r7gd', 'Graviton3', '', '', 'r8gd', 'r6id', '', 'r6gd', 'r7gd', 'r8gd')
          , ROW ('r7iz', 'Latest', 'r7iz', '', 'r8g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r8gb', 'Graviton4', '', '', 'r8gb', 'r7i', '', '', '', 'r8gb')
          , ROW ('r8gd', 'Graviton4', '', '', 'r8gd', 'r7i', '', 'r6gd', 'r7gd', 'r8gd')
          , ROW ('r8gn', 'Graviton4', '', '', 'r8gn', 'r7i', '', '', '', 'r8gn')
          , ROW ('r8i', 'Latest', 'r8i', '', 'r8g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('r8i-flex', 'Latest', 'r8i-flex', '', 'r8g', '', '', 'r6g', 'r7g', 'r8g')
          , ROW ('trn1', 'Latest', 'trn2', '', '', '', '', '', '', '')
          , ROW ('trn1n', 'Latest', 'trn2', '', '', '', '', '', '', '')
          , ROW ('trn2', 'Latest', 'trn2', '', '', '', '', '', '', '')
          , ROW ('trn2u', 'Latest', 'trn2u', '', '', '', '', '', '', '')
          , ROW ('u-12tb1', 'Latest', 'u7i-12tb', '', '', '', '', '', '', '')
          , ROW ('u-18tb1', 'Latest', 'u7in-16tb', '', '', '', '', '', '', '')
          , ROW ('u-24tb1', 'Latest', 'u7in-24tb', '', '', '', '', '', '', '')
          , ROW ('u-3tb1', 'Latest', 'u7i-6tb', '', '', '', '', '', '', '')
          , ROW ('u-6tb1', 'Latest', 'u7i-6tb', '', '', '', '', '', '', '')
          , ROW ('u-9tb1', 'Latest', 'u7i-8tb', '', '', '', '', '', '', '')
          , ROW ('u7i-12tb', 'Latest', 'u7i-12tb', '', '', '', '', '', '', '')
          , ROW ('u7i-6tb', 'Latest', 'u7i-6tb', '', '', '', '', '', '', '')
          , ROW ('u7i-8tb', 'Latest', 'u7i-8tb', '', '', '', '', '', '', '')
          , ROW ('u7in-16tb', 'Latest', 'u7in-16tb', '', '', '', '', '', '', '')
          , ROW ('u7in-24tb', 'Latest', 'u7in-24tb', '', '', '', '', '', '', '')
          , ROW ('u7in-32tb', 'Latest', 'u7in-32tb', '', '', '', '', '', '', '')
          , ROW ('u7inh-32tb', 'Latest', 'u7inh-32tb', '', '', '', '', '', '', '')
          , ROW ('vt1', 'Latest', 'vt1', '', '', '', '', '', '', '')
          , ROW ('x2idn', 'Latest', 'x2idn', '', 'x8g', '', '', 'x2gd', '', 'x8g')
          , ROW ('x2iedn', 'Latest', 'x2iedn', '', 'x8g', '', '', '', '', '')
          , ROW ('x2iezn', 'Latest', 'x2iezn', '', 'x8g', '', '', '', '', '')
          , ROW ('x8g', 'Graviton4', '', '', 'x8g', 'x2idn', '', '', '', '')
          , ROW ('z1', 'Latest', 'z1d', '', '', '', '', '', '', '')
          , ROW ('z1d', 'Latest', 'z1d', '', '', '', '', '', '', '')
          -- RDS Database Instances - Original Families
          , ROW ('db.cv11', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('db.m1', 'Previous', 'db.m6i', '', 'db.m6g', '', '', '', '', '')
          , ROW ('db.m2', 'Previous', 'db.m6i', '', 'db.m6g', '', '', '', '', '')
          , ROW ('db.m3', 'Previous', 'db.m6i', '', 'db.m6g', '', '', '', '', '')
          , ROW ('db.m4', 'Preceding', 'db.m6i', '', 'db.m6g', '', '', '', '', '')
          , ROW ('db.m5', 'Preceding', 'db.m6i', '', 'db.m6g', '', '', '', '', '')
          , ROW ('db.m5d', 'Latest', '', '', 'db.m6gd', '', '', '', '', '')
          , ROW ('db.m6g', 'Graviton2', '', '', '', 'db.m6i', '', '', '', '')
          , ROW ('db.m6gd', 'Graviton2', '', '', '', 'db.m5d', '', '', '', '')
          , ROW ('db.m6i', 'Latest', '', '', 'db.m6g', '', '', '', '', '')
          , ROW ('db.mv11', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('db.r3', 'Previous', 'db.r6i', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r4', 'Preceding', 'db.r6i', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r5', 'Preceding', 'db.r6i', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r5b', 'Latest', '', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r5d', 'Latest', '', '', 'db.r6gd', '', '', '', '', '')
          , ROW ('db.r6g', 'Graviton2', '', '', '', 'db.r6i', '', '', '', '')
          , ROW ('db.r6gd', 'Graviton2', '', '', '', 'db.r5d', '', '', '', '')
          , ROW ('db.r6i', 'Latest', '', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.rv11', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('db.t1', 'Previous', 'db.t3', '', 'db.t4g', '', '', '', '', '')
          , ROW ('db.t2', 'Preceding', 'db.t3', '', 'db.t4g', '', '', '', '', '')
          , ROW ('db.t3', 'Latest', '', '', 'db.t4g', '', '', '', '', '')
          , ROW ('db.t4g', 'Graviton2', '', '', '', 'db.t3', '', '', '', '')
          , ROW ('db.x2g', 'Graviton2', '', '', '', '', '', '', '', '')
          -- RDS Database Instances - New Families Added October 2025
          , ROW ('db.m6id', 'Latest', 'db.m6id', '', 'db.m7g', '', '', '', '', '')
          , ROW ('db.m6idn', 'Latest', 'db.m6idn', '', 'db.m7g', '', '', '', '', '')
          , ROW ('db.m6in', 'Latest', 'db.m6in', '', 'db.m7g', '', '', '', '', '')
          , ROW ('db.m7g', 'Graviton3', '', '', '', 'db.m6i', '', '', 'db.m7g', 'db.m8g')
          , ROW ('db.m7i', 'Latest', 'db.m7i', '', 'db.m8g', '', '', '', 'db.m7g', 'db.m8g')
          , ROW ('db.m8g', 'Graviton4', '', '', '', 'db.m7i', '', '', '', 'db.m8g')
          , ROW ('db.r6id', 'Latest', 'db.r6id', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r6idn', 'Latest', 'db.r6idn', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r6in', 'Latest', 'db.r6in', '', 'db.r7g', '', '', '', '', '')
          , ROW ('db.r7g', 'Graviton3', '', '', '', 'db.r6i', '', '', 'db.r7g', 'db.r8g')
          , ROW ('db.r7i', 'Latest', 'db.r7i', '', 'db.r8g', '', '', '', 'db.r7g', 'db.r8g')
          , ROW ('db.r8g', 'Graviton4', '', '', '', 'db.r7i', '', '', '', 'db.r8g')
          , ROW ('db.x1', 'Latest', 'db.x1', '', 'db.x2g', '', '', 'db.x2g', '', '')
          , ROW ('db.x1e', 'Latest', 'db.x1e', '', 'db.x2g', '', '', 'db.x2g', '', '')
          , ROW ('db.x2idn', 'Latest', 'db.x2idn', '', '', '', '', '', '', '')
          , ROW ('db.x2iedn', 'Latest', 'db.x2iedn', '', '', '', '', '', '', '')
          , ROW ('db.x2iezn', 'Latest', 'db.x2iezn', '', '', '', '', '', '', '')
          , ROW ('db.z1d', 'Latest', 'db.z1d', '', '', '', '', '', '', '')
          -- ElastiCache Instances - Original Families
          , ROW ('cache.c1', 'Previous', '', '', '', '', '', '', '', '')
          , ROW ('cache.m1', 'Previous', 'cache.m5', '', 'cache.m6g', '', '', '', '', '')
          , ROW ('cache.m2', 'Previous', 'cache.m5', '', 'cache.m6g', '', '', '', '', '')
          , ROW ('cache.m3', 'Previous', 'cache.m5', '', 'cache.m6g', '', '', '', '', '')
          , ROW ('cache.m4', 'Preceding', 'cache.m5', '', 'cache.m6g', '', '', '', '', '')
          , ROW ('cache.m5', 'Latest', '', '', 'cache.m6g', '', '', '', '', '')
          , ROW ('cache.m6g', 'Graviton2', '', '', '', 'cache.m5', '', '', '', '')
          , ROW ('cache.r3', 'Previous', 'cache.r5', '', 'cache.r6g', '', '', '', '', '')
          , ROW ('cache.r4', 'Preceding', 'cache.r5', '', 'cache.r6g', '', '', '', '', '')
          , ROW ('cache.r5', 'Latest', '', '', 'cache.r6g', '', '', '', '', '')
          , ROW ('cache.r6g', 'Graviton2', '', '', '', 'cache.r5', '', '', '', '')
          , ROW ('cache.r6gd', 'Graviton2', '', '', '', 'cache.r5', '', '', '', '')
          , ROW ('cache.r7g', 'Graviton3', '', '', '', 'cache.r5', '', '', '', '')
          , ROW ('cache.t1', 'Previous', 'cache.t3', '', 'cache.t4g', '', '', '', '', '')
          , ROW ('cache.t2', 'Preceding', 'cache.t3', '', 'cache.t4g', '', '', '', '', '')
          , ROW ('cache.t3', 'Latest', '', '', 'cache.t4g', '', '', '', '', '')
          , ROW ('cache.t4g', 'Graviton2', '', '', '', 'cache.t3', '', '', '', '')
          -- ElastiCache Instances - New Families Added October 2025
          , ROW ('cache.c7gn', 'Graviton3', '', '', '', '', '', '', 'cache.c7gn', '')
          , ROW ('cache.m7g', 'Graviton3', '', '', '', 'cache.m5', '', '', 'cache.m7g', '')
          -- OpenSearch Instances - Original Families
          , ROW ('c4.search', 'Preceding', 'c5', '', 'c6g', '', '', '', '', '')
          , ROW ('c5.search', 'Latest', '', '', 'c6g', '', '', '', '', '')
          , ROW ('c6g.search', 'Graviton2', '', '', '', 'c5', '', '', '', '')
          , ROW ('i2.search', 'Preceding', 'i3', '', '', '', '', '', '', '')
          , ROW ('i3.search', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('m3.search', 'Previous', 'm5', '', 'm6g', '', '', '', '', '')
          , ROW ('m4.search', 'Preceding', 'm5', '', 'm6g', '', '', '', '', '')
          , ROW ('m5.search', 'Latest', '', '', 'm6g', '', '', '', '', '')
          , ROW ('m6g.search', 'Graviton2', '', '', '', 'm5', '', '', '', '')
          , ROW ('r3.search', 'Preceding', 'r5', '', 'r6g', '', '', '', '', '')
          , ROW ('r4.search', 'Previous', 'r5', '', 'r6g', '', '', '', '', '')
          , ROW ('r5.search', 'Latest', '', '', 'r6g', '', '', '', '', '')
          , ROW ('r6g.search', 'Graviton2', '', '', '', 'r5', '', '', '', '')
          , ROW ('r6gd.search', 'Graviton2', '', '', '', 'r5', '', '', '', '')
          , ROW ('t2.search', 'Preceding', 't3', '', '', '', '', '', '', '')
          , ROW ('t3.search', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('ultrawarm1', 'Latest', '', '', '', '', '', '', '', '')
          , ROW ('ultrawarm1.search', 'Latest', '', '', '', '', '', '', '', '')
          -- OpenSearch Instances - New Families Added October 2025
          , ROW ('c7g.search', 'Graviton3', '', '', '', 'c5', '', '', 'c7g.search', '')
          , ROW ('c7i.search', 'Latest', 'c7i.search', '', 'c7g.search', '', 'c7i', '', 'c7g.search', '')
          , ROW ('i4g.search', 'Graviton3', '', '', '', '', '', '', 'i4g.search', '')
          , ROW ('i4i.search', 'Latest', 'i4i.search', '', 'i4g.search', '', 'i4i', '', 'i4g.search', '')
          , ROW ('i8g.search', 'Graviton4', '', '', '', '', '', '', '', 'i8g.search')
          , ROW ('im4gn.search', 'Graviton2', '', '', '', '', '', 'im4gn.search', '', '')
          , ROW ('m7g.search', 'Graviton3', '', '', '', 'm5', '', '', 'm7g.search', '')
          , ROW ('m7i.search', 'Latest', 'm7i.search', '', 'm7g.search', '', 'm7i', '', 'm7g.search', '')
          , ROW ('om2.search', 'Latest', 'om2.search', '', '', '', 'om2', '', '', '')
          , ROW ('or1.search', 'Latest', 'or1.search', '', '', '', 'or1', '', '', '')
          , ROW ('or2.search', 'Latest', 'or2.search', '', '', '', 'or2', '', '', '')
          , ROW ('r7g.search', 'Graviton3', '', '', '', 'r5', '', '', 'r7g.search', '')
          , ROW ('r7gd.search', 'Graviton3', '', '', '', 'r5', '', '', 'r7gd.search', '')
          , ROW ('r7i.search', 'Latest', 'r7i.search', '', 'r7g.search', '', 'r7i', '', 'r7g.search', '')
        )  ignored_table_name (family, generation, latest_intel, latest_amd, latest_arm, previous_intel, latest_elasticsearch_intel, graviton2, graviton3, graviton4)
    dependsOn: {}