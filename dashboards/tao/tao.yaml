dashboards:
  TAO:
    dependsOn:
      datasets:
      - ta-organizational-view
      - ta_priority_org_view
    name: Trusted Advisor Organizational View
    dashboardId: ta-organizational-view
    category: Advanced
    theme: MIDNIGHT
    version: v4.0.0
    file: ./tao-definition.yaml
datasets:
  ta_priority_org_view:
    data:
      DataSetId: 7f31f86d-88b3-41e6-adad-a3ce68858923
      Name: ta_priority_org_view
      PhysicalTableMap:
        30d52db3-daf0-4f90-9716-52ba236f446d:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: ta_priority_org_view
            InputColumns:
            - Name: recommendationarn
              Type: STRING
            - Name: name
              Type: STRING
            - Name: description
              Type: STRING
            - Name: awsservices
              Type: STRING
            - Name: createdat
              Type: DATETIME
            - Name: resolvedat
              Type: DATETIME
            - Name: lastupdatedat
              Type: DATETIME
            - Name: lifecyclestage
              Type: STRING
            - Name: recommendationstatus
              Type: STRING
            - Name: pillars
              Type: STRING
            - Name: source
              Type: STRING
            - Name: accountid
              Type: STRING
            - Name: accountname
              Type: STRING
            - Name: awsresourcedetails
              Type: STRING
            - Name: recommresourceid
              Type: STRING
            - Name: recommresourcearn
              Type: STRING
            - Name: exclusionstatus
              Type: STRING
            - Name: regioncode
              Type: STRING
            - Name: resourcestatus
              Type: STRING
            - Name: payer_id
              Type: STRING
            - Name: year
              Type: STRING
            - Name: month
              Type: STRING
            - Name: is_latest_update
              Type: INTEGER
        78030af5-de76-4ef2-919e-492e863297d7:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: account_name
              Type: STRING
      LogicalTableMap:
        0dfe9952-20ee-4c0f-b43a-a341abdc077e:
          Alias: account_map
          Source:
            PhysicalTableId: 78030af5-de76-4ef2-919e-492e863297d7
        43044088-10c8-4dd5-ab99-262e1008e11e:
          Alias: ta_priority_org_view
          Source:
            PhysicalTableId: 30d52db3-daf0-4f90-9716-52ba236f446d
        6e44076f-d8b5-45b5-8d38-076a55d3c338:
          Alias: Intermediate Table
          DataTransforms:
          - CreateColumnsOperation:
              Columns:
              - ColumnName: ResourceStatus_Modified
                ColumnId: ad4de6bc-6dd1-4999-9bf6-6e761b88ecd9
                Expression: |-
                  ifelse(
                      {resourcestatus} = 'error', 'Red',
                      {resourcestatus} = 'warning', 'Yellow',
                      {resourcestatus} = 'ok', 'Green',
                      {resourcestatus} = 'N/A','Red',
                      {resourcestatus}
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: ResourceID
                ColumnId: ce979b5f-4ca1-43cb-9c3c-f483261328c3
                Expression: concat({recommendationarn},"-",{recommresourceid})
          - CreateColumnsOperation:
              Columns:
              - ColumnName: DateMon
                ColumnId: 8eb9bcfb-ddb1-4d68-ac17-52c6e268bcd0
                Expression: concat({year}, "-", {month})
          - CreateColumnsOperation:
              Columns:
              - ColumnName: AccountID_Name
                ColumnId: e7911ebf-b802-4317-85ff-48437580dc1c
                Expression: 'concat({accountname}, ": ", {accountid})'
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Pillars_Modified
                ColumnId: 033c2716-f0ac-4fa1-9686-b27b5d07b650
                Expression: |-
                  ifelse(
                      {pillars} = '["cost_optimizing"]', 'Cost Optimization',
                      {pillars} = '["performance"]', 'Performance',
                      {pillars} = '["security"]', 'Security',
                      {pillars} = '["service_limits"]','Service Limits',
                      {pillars} = '["fault_tolerance"]','Fault Tolerance',
                      {pillars} = '["operational_excellence"]','Operational Excellence',
                      {pillars}
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Source_Modified
                ColumnId: d99c9cb3-8bb6-4c18-87fd-132ad093d2e0
                Expression: |-
                  ifelse(
                      {source} = 'aws_config', 'AWS Config',
                      {source} = 'compute_optimizer', 'Compute Optimizer',
                      {source} = 'cost_explorer', 'Cost Explorer',
                      {source} = 'lse','Large Scale Events',
                      {source} = 'manual', 'Manual (Account Team)',
                      {source} = 'pse', 'Proactive Support Events',
                      {source} = 'rds', 'RDS',
                      {source} = 'resilience','Resilience',
                      {source} = 'resilience_hub', 'Resilience Hub',
                      {source} = 'security_hub', 'Security Hub',
                      {source} = 'stir', 'Service Team Incident Response',
                      {source} = 'ta_check','Trusted Advisor Checks',
                      {source} = 'well_architected','AWS Well-Architected Recommendations',
                      {source}
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: LifecycleStage_Modified
                ColumnId: d0e62aa3-f547-4a09-badb-fbafc4a74db2
                Expression: |-
                  ifelse(
                      {lifecyclestage} = 'in_progress', 'In Progress',
                      {lifecyclestage} = 'pending_response', 'Pending Response',
                      {lifecyclestage} = 'dismissed', 'Dismissed',
                      {lifecyclestage} = 'resolved','Resolved',
                      {lifecyclestage}
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: ResolvedAt_Modified
                ColumnId: 59e2cf5d-64a2-40bd-a71e-39b5eb1a2c6a
                Expression: |-
                  ifelse(
                      {lifecyclestage} = 'in_progress', NULL,
                      {lifecyclestage} = 'pending_response', NULL,
                      {lifecyclestage} = 'dismissed', {resolvedat},
                      {lifecyclestage} = 'resolved',{resolvedat},
                      {resolvedat}
                  )
          - ProjectOperation:
              ProjectedColumns:
              - recommendationarn
              - name
              - description
              - awsservices
              - createdat
              - resolvedat
              - lastupdatedat
              - lifecyclestage
              - recommendationstatus
              - pillars
              - source
              - accountid
              - accountname
              - awsresourcedetails
              - recommresourceid
              - recommresourcearn
              - exclusionstatus
              - regioncode
              - resourcestatus
              - payer_id
              - year
              - month
              - is_latest_update
              - account_id
              - account_name
              - ResourceStatus_Modified
              - ResourceID
              - DateMon
              - AccountID_Name
              - Pillars_Modified
              - Source_Modified
              - LifecycleStage_Modified
              - ResolvedAt_Modified
          Source:
            JoinInstruction:
              LeftOperand: 43044088-10c8-4dd5-ab99-262e1008e11e
              RightOperand: 0dfe9952-20ee-4c0f-b43a-a341abdc077e
              Type: LEFT
              OnClause: '{accountid} = {account_id}'
      ImportMode: SPICE
    dependsOn:
      views:
      - ta_priority_org_view
      - account_map
    schedules:
    - default
  ta-organizational-view:
    data:
      DataSetId: ta-organizational-view
      Name: ta-organizational-view
      PhysicalTableMap:
        99142d9e-0831-40c4-8744-261696fb2f12:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Catalog: AwsDataCatalog
            Schema: ${athena_database_name}
            Name: account_map
            InputColumns:
            - Name: account_id
              Type: STRING
            - Name: account_name
              Type: STRING
        b5de237f-b599-407f-87ec-32024624ba65:
          RelationalTable:
            DataSourceArn: ${athena_datasource_arn}
            Schema: ${athena_database_name}
            Name: ta_org_view
            InputColumns:
            - Name: ip address
              Type: STRING
            - Name: checkname
              Type: STRING
            - Name: accountparentname
              Type: STRING
            - Name: accountid
              Type: STRING
            - Name: category
              Type: STRING
            - Name: checkid
              Type: STRING
            - Name: issuppressed
              Type: STRING
            - Name: resourceid
              Type: STRING
            - Name: region
              Type: STRING
            - Name: accountparentid
              Type: STRING
            - Name: timestamp
              Type: STRING
            - Name: accountname
              Type: STRING
            - Name: status
              Type: STRING
            - Name: acl allows list
              Type: STRING
            - Name: bucket name
              Type: STRING
            - Name: acl allows upload/delete
              Type: STRING
            - Name: region name
              Type: STRING
            - Name: policy allows access
              Type: STRING
            - Name: ignored bucket name
              Type: STRING
            - Name: region api parameter
              Type: STRING
            - Name: password policy
              Type: STRING
            - Name: reason
              Type: STRING
            - Name: number
              Type: STRING
            - Name: uppercase
              Type: STRING
            - Name: lowercase
              Type: STRING
            - Name: non-alphanumeric
              Type: STRING
            - Name: write enabled
              Type: STRING
            - Name: same owner
              Type: STRING
            - Name: target exists
              Type: STRING
            - Name: target name
              Type: STRING
            - Name: trail name
              Type: STRING
            - Name: logging status
              Type: STRING
            - Name: last delivery error
              Type: STRING
            - Name: access key
              Type: STRING
            - Name: key last rotated
              Type: STRING
            - Name: iam user
              Type: STRING
            - Name: mfa delete enabled
              Type: STRING
            - Name: versioning
              Type: STRING
            - Name: current usage
              Type: STRING
            - Name: service
              Type: STRING
            - Name: limit amount
              Type: STRING
            - Name: limit name
              Type: STRING
            - Name: snapshot id
              Type: STRING
            - Name: volume name
              Type: STRING
            - Name: snapshot age
              Type: STRING
            - Name: volume attachment
              Type: STRING
            - Name: volume id
              Type: STRING
            - Name: snapshot name
              Type: STRING
            - Name: volume type
              Type: STRING
            - Name: volume size
              Type: STRING
            - Name: monthly storage cost
              Type: STRING
            - Name: max daily median
              Type: STRING
            - Name: number of days over
              Type: STRING
            - Name: day 14
              Type: STRING
            - Name: day 13
              Type: STRING
            - Name: day 12
              Type: STRING
            - Name: day 11
              Type: STRING
            - Name: day 10
              Type: STRING
            - Name: day 1
              Type: STRING
            - Name: day 2
              Type: STRING
            - Name: day 3
              Type: STRING
            - Name: day 8
              Type: STRING
            - Name: day 9
              Type: STRING
            - Name: day 4
              Type: STRING
            - Name: day 5
              Type: STRING
            - Name: day 6
              Type: STRING
            - Name: day 7
              Type: STRING
            - Name: region/az
              Type: STRING
            - Name: 14-day average cpu utilization
              Type: STRING
            - Name: instance type
              Type: STRING
            - Name: instance name
              Type: STRING
            - Name: estimated monthly savings
              Type: STRING
            - Name: 14-day average network i/o
              Type: STRING
            - Name: number of days low utilization
              Type: STRING
            - Name: instance id
              Type: STRING
            - Name: instances in zone a
              Type: STRING
            - Name: instances in zone b
              Type: STRING
            - Name: instances in zone e
              Type: STRING
            - Name: instances in zone f
              Type: STRING
            - Name: instances in zone c
              Type: STRING
            - Name: instances in zone d
              Type: STRING
            - Name: load balancer associated
              Type: STRING
            - Name: auto scaling group name
              Type: STRING
            - Name: health check
              Type: STRING
            - Name: total inbound rules
              Type: STRING
            - Name: total outbound rules
              Type: STRING
            - Name: vpc id
              Type: STRING
            - Name: db instance
              Type: STRING
            - Name: multi-az
              Type: STRING
            - Name: security group id
              Type: STRING
            - Name: ports
              Type: STRING
            - Name: security group name
              Type: STRING
            - Name: protocol
              Type: STRING
            - Name: port
              Type: STRING
            - Name: ip range
              Type: STRING
            - Name: customer gateway
              Type: STRING
            - Name: vpc
              Type: STRING
            - Name: active tunnels
              Type: STRING
            - Name: vpn id
              Type: STRING
            - Name: virtual private gateway
              Type: STRING
            - Name: distribution domain name
              Type: STRING
            - Name: distribution id
              Type: STRING
            - Name: alternate domain name
              Type: STRING
            - Name: hosted zone name
              Type: STRING
            - Name: hosted zone id
              Type: STRING
            - Name: number of name server delegations used
              Type: STRING
            - Name: number of days over 90% cpu utilization
              Type: STRING
            - Name: resource name
              Type: STRING
            - Name: launch configuration name
              Type: STRING
            - Name: launch type
              Type: STRING
            - Name: resource type
              Type: STRING
            - Name: launch name
              Type: STRING
            - Name: backup retention period
              Type: STRING
            - Name: description
              Type: STRING
            - Name: instance count
              Type: STRING
            - Name: group id
              Type: STRING
            - Name: resource record set identifier
              Type: STRING
            - Name: resource record set type
              Type: STRING
            - Name: alias target
              Type: STRING
            - Name: resource record set name
              Type: STRING
            - Name: headers
              Type: STRING
            - Name: cache behavior path pattern
              Type: STRING
            - Name: lookback period (days)
              Type: STRING
            - Name: upfront cost
              Type: STRING
            - Name: payment option
              Type: STRING
            - Name: hourly commitment to purchase
              Type: STRING
            - Name: estimated savings percentage
              Type: STRING
            - Name: term (years)
              Type: STRING
            - Name: savings plan type
              Type: STRING
            - Name: estimated average utilization
              Type: STRING
            - Name: origin
              Type: STRING
            - Name: days since last connection
              Type: STRING
            - Name: db instance name
              Type: STRING
            - Name: storage provisioned (gb)
              Type: STRING
            - Name: estimated monthly savings (on demand)
              Type: STRING
            - Name: cluster
              Type: STRING
            - Name: estimated break even (months)
              Type: STRING
            - Name: platform
              Type: STRING
            - Name: expected average ri utilization
              Type: STRING
            - Name: estimated on-demand cost post recommended ri purchase (monthly)
              Type: STRING
            - Name: recommended number of ris to purchase
              Type: STRING
            - Name: upfront cost of ris
              Type: STRING
            - Name: estimated savings with recommendation (monthly)
              Type: STRING
            - Name: estimated cost of ris (monthly)
              Type: STRING
            - Name: load balancer name
              Type: STRING
            - Name: '# of zones'
              Type: STRING
            - Name: access key id
              Type: STRING
            - Name: case id
              Type: STRING
            - Name: certificate name
              Type: STRING
            - Name: connection details
              Type: STRING
            - Name: connection id for vif
              Type: STRING
            - Name: connection id
              Type: STRING
            - Name: current monthly cost
              Type: STRING
            - Name: data transfer out (gb)
              Type: STRING
            - Name: database edition
              Type: STRING
            - Name: database engine
              Type: STRING
            - Name: db instance or cluster id
              Type: STRING
            - Name: deadline
              Type: STRING
            - Name: deployment option
              Type: STRING
            - Name: ebs optimized
              Type: STRING
            - Name: estimated cost of reserved instances (monthly)
              Type: STRING
            - Name: estimated cost of reserved nodes (monthly)
              Type: STRING
            - Name: estimated on-demand cost post recommended reserved instance purchase
                (monthly)
              Type: STRING
            - Name: estimated on-demand cost post recommended reserved nodes purchase
                (monthly)
              Type: STRING
            - Name: expected average reserved instance utilization
              Type: STRING
            - Name: expected average reserved node utilization
              Type: STRING
            - Name: expected avergae reserved instance utilization
              Type: STRING
            - Name: expected avergae reserved node utilization
              Type: STRING
            - Name: expiration date
              Type: STRING
            - Name: family
              Type: STRING
            - Name: fraud type
              Type: STRING
            - Name: gateway id
              Type: STRING
            - Name: ingress rule
              Type: STRING
            - Name: instance class
              Type: STRING
            - Name: instance size
              Type: STRING
            - Name: license model
              Type: STRING
            - Name: load balancer port
              Type: STRING
            - Name: location for vif
              Type: STRING
            - Name: location
              Type: STRING
            - Name: node type
              Type: STRING
            - Name: private db instances
              Type: STRING
            - Name: product description
              Type: STRING
            - Name: public db instances
              Type: STRING
            - Name: ratio of transfer to storage
              Type: STRING
            - Name: rds security group name
              Type: STRING
            - Name: recommended number of reserved instances to purchase
              Type: STRING
            - Name: recommended number of reserved nodes to purchase
              Type: STRING
            - Name: reserved instance id
              Type: STRING
            - Name: resource record set id
              Type: STRING
            - Name: s3 storage (gb)
              Type: STRING
            - Name: security group ids
              Type: STRING
            - Name: time near maximum
              Type: STRING
            - Name: time updated
              Type: STRING
            - Name: ttl
              Type: STRING
            - Name: upfront cost of reserved instances
              Type: STRING
            - Name: upfront cost of reserved nodes
              Type: STRING
            - Name: usage (usd per day)
              Type: STRING
            - Name: user name (iam or root)
              Type: STRING
            - Name: zone
              Type: STRING
            - Name: function arn
              Type: STRING
            - Name: max daily error rate
              Type: STRING
            - Name: date for max error rate
              Type: STRING
            - Name: average daily error rate
              Type: STRING
            - Name: lost daily compute cost
              Type: STRING
            - Name: current day invokes
              Type: STRING
            - Name: current day error rate
              Type: STRING
            - Name: average daily invokes
              Type: STRING
            - Name: last refresh time
              Type: STRING
            - Name: max daily timeout rate
              Type: STRING
            - Name: date of max daily timeout rate
              Type: STRING
            - Name: average daily timeout rate
              Type: STRING
            - Name: function timeout setting
              Type: STRING
            - Name: current day timeout rate
              Type: STRING
            - Name: runtime
              Type: STRING
            - Name: days to deprecation
              Type: STRING
            - Name: deprecation date
              Type: STRING
            - Name: resource
              Type: STRING
            - Name: workload type
              Type: STRING
            - Name: workload last modified date
              Type: STRING
            - Name: workload started date
              Type: STRING
            - Name: number of questions answered for performance
              Type: STRING
            - Name: number of hris resolved for performance
              Type: STRING
            - Name: total number of questions in performance pillar
              Type: STRING
            - Name: number of identified hris for performance
              Type: STRING
            - Name: reviewer name
              Type: STRING
            - Name: workload arn
              Type: STRING
            - Name: workload name
              Type: STRING
            - Name: number of hris resolved for reliability
              Type: STRING
            - Name: total number of questions in reliability pillar
              Type: STRING
            - Name: number of questions answered for reliability
              Type: STRING
            - Name: number of identified hris for reliability
              Type: STRING
            - Name: number of hris resolved for security
              Type: STRING
            - Name: total number of questions in security pillar
              Type: STRING
            - Name: number of questions answered for security
              Type: STRING
            - Name: number of identified hris for security
              Type: STRING
            - Name: number of hris resolved for cost optimization
              Type: STRING
            - Name: total number of questions in cost optimization pillar
              Type: STRING
            - Name: number of questions answered for cost optimization
              Type: STRING
            - Name: number of identified hris for cost optimization
              Type: STRING
            - Name: cluster name
              Type: STRING
            - Name: resource id
              Type: STRING
            - Name: recommended action
              Type: STRING
            - Name: current resource summary
              Type: STRING
            - Name: recommended resource summary
              Type: STRING
            - Name: estimated monthly cost
              Type: STRING
            - Name: last refresh time stamp
              Type: STRING
            - Name: logging enabled
              Type: STRING
            - Name: delivery error reported
              Type: STRING
            - Name: last updated time
              Type: STRING
      LogicalTableMap:
        2833c566-cf25-46aa-ad2c-e240d0b1aa9c:
          Alias: Intermediate Table
          DataTransforms:
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Check Name
                ColumnId: 0faa07a9-3583-4b17-ad9c-cdb746b8fc19
                Expression: checkname
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Account
                ColumnId: bc17d09c-5a52-4e82-a166-925f8178166d
                Expression: |-
                  ifelse(
                      accountname = '' OR isNull(accountname),
                      accountid,
                      concat(accountname,': ',accountid)
                      )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Resource Id
                ColumnId: 88b4612e-f9b6-4fff-9e4a-32cdf90b9a86
                Expression: |-
                  ifelse(
                  startsWith({checkid},'c1z7kmr'),
                  concat({resource id},{Account}, {region}),
                  concat({resourceid},{Account})
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Resource Name
                ColumnId: c32a279b-d728-4947-b6db-f122b7f5250f
                Expression: |-
                  ifelse(
                  {Check Name} = 'Idle Load Balancers', {load balancer name},
                  {Check Name} = 'Amazon RDS cost optimization recommendations for DB instances', {resource id},
                  {Check Name} = 'Amazon RDS cost optimization recommendations for DB instance storage', {resource id},
                  {Check Name} = 'Amazon Aurora cost optimization recommendations for DB cluster storage', {resource id},
                  {Check Name} = 'Amazon RDS Idle DB Instances', {db instance name},
                  {Check Name} = 'Low Utilization Amazon EC2 Instances', {instance id},
                  {Check Name} = 'Unassociated Elastic IP Addresses', {ip address},
                  {Check Name} = 'Underutilized Amazon EBS Volumes', {volume id},
                  {Check Name} = 'Underutilized Amazon Redshift Clusters', cluster,
                  {Check Name} = 'Amazon EBS Public Snapshots', {volume id},
                  {Check Name} = 'Amazon RDS Public Snapshots', {db instance or cluster id},
                  {Check Name} = 'AWS Lambda Functions with High Error Rates', {function arn},
                  {Check Name} = 'AWS Lambda Functions Using Deprecated Runtimes', {function arn},
                  checkid = 'Wxdfp4B1L1' OR checkid = 'Wxdfp4B1L2' OR checkid = 'Wxdfp4B1L3' OR checkid = 'Wxdfp4B1L4',{workload arn},
                  {Resource Id}
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Datetime
                ColumnId: a22e1199-f893-48d1-9066-e37c4c7d0f94
                Expression: epochDate(parseInt(timestamp))
          - CreateColumnsOperation:
              Columns:
              - ColumnName: First Check for Resource
                ColumnId: b2d7393f-c258-45ce-aa35-e93bdd879652
                Expression: minOver(Datetime, [{Resource Id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Last Check for Resource
                ColumnId: da58a4e8-1246-46a2-b1f2-416d33eb1d51
                Expression: maxOver(Datetime, [{Resource Id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Last Check for Account and CheckId
                ColumnId: e6e521cf-63eb-488a-9173-8e22fc341d3b
                Expression: 'maxOver(Datetime,[accountid], PRE_FILTER)

                  '
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Resource in Last Check
                ColumnId: f3f28fd1-5b05-48d4-8b73-54f7981213e4
                Expression: ifelse(dateDiff({Last Check for Resource},{Last Check
                  for Account and CheckId}) >= 8, 'no', 'yes')
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Estimated Monthly Savings Numeric
                ColumnId: 963fa412-d889-4c35-8d90-31839c3fdd27
                Expression: "ifelse(\n{checkname} = 'Idle Load Balancers', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'Amazon EC2\
                  \ cost optimization recommendations for instances', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'Amazon EBS\
                  \ cost optimization recommendations for volumes', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'Amazon RDS\
                  \ cost optimization recommendations for DB instances', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'AWS Lambda\
                  \ cost optimization recommendations for functions', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'Amazon EC2\
                  \ cost optimization recommendations for Amazon EC2 Auto Scaling\
                  \ groups', parseDecimal(replace(replace({estimated monthly savings},'$',''),',','')),\n\
                  {checkname} = 'Amazon RDS cost optimization recommendations for\
                  \ DB instance storage', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'AWS Fargate\
                  \ cost optimization recommendations for Amazon ECS', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'Amazon Aurora\
                  \ cost optimization recommendations for DB cluster storage', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'Underutilized\
                  \ Amazon Redshift Clusters', parseDecimal(replace(replace({estimated\
                  \ monthly savings},'$',''),',','')),\n{checkname} = 'AWS\_Lambda\_\
                  Functions\_with\_High\_Error\_Rates', parseDecimal(replace(replace({lost\
                  \ daily compute cost},'$',''),',',''))*30,\nnull\n)"
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Status
                ColumnId: e178b4e6-14c0-4826-a40b-d42c7838fa9d
                Expression: |-
                  ifelse(
                      status = 'error',
                      'Red',
                      status = 'warning',
                      'Yellow',
                      status = 'ok',
                      'Green',
                      status
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Category
                ColumnId: 1d145d5d-46d9-4c58-8ee2-694e7b53f5b1
                Expression: |-
                  ifelse(
                      category = 'cost_optimizing',
                      'Cost Optimizing',
                      category = 'operational_excellence',
                      'Operational Excellence',
                      category = 'fault_tolerance',
                      'Fault Tolerance',
                      category = 'security',
                      'Security',
                      category = 'performance',
                      'Performance',
                      category = 'service_limits',
                      'Service Limits',
                      category
                  )
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Deprecation Date
                ColumnId: e351a4a5-1a61-4ee5-9927-69040296e120
                Expression: maxOver(parseDate({deprecation date},'MM/dd/yyyy'),[{Resource
                  Name}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Average Daily Invokes
                ColumnId: 0108dd54-9ae3-447d-97d8-788894e6a8ae
                Expression: maxOver(parseDecimal({average daily invokes}),[{Resource
                  Name}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Number of Days Low Utilization
                ColumnId: b9a05d2d-5997-4677-9ad4-73f1f0534210
                Expression: maxOver(parseInt(replace({number of days low utilization},
                  ' days','')), [{Resource Id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: 14-Day Average CPU Utilization
                ColumnId: d04502b9-c9df-4ef0-a78d-a11771b5967f
                Expression: maxOver(parseDecimal(replace({14-day average cpu utilization},
                  '%','')), [{Resource Id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: 14-Day Average Network I/O
                ColumnId: c059301f-0228-44be-b827-4337615995ac
                Expression: maxOver(parseDecimal(replace({14-day average network i/o},
                  'MB','')), [{Resource Id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Max Daily Error Rate
                ColumnId: b6ea96d4-6a88-49ac-b24d-b12942c72fd4
                Expression: maxOver(parseDecimal({max daily error rate}),[{Resource
                  Id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Date for Max Error Rate
                ColumnId: ae799e1f-17d8-44dd-9374-f538a041200b
                Expression: 'maxOver(parseDate({date for max error rate},''MM/dd/yyyy''),[{Resource
                  Id}],PRE_AGG)

                  '
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Average Daily Error Rate
                ColumnId: e22c306a-1ef8-472e-9c98-0b487cf917c2
                Expression: 'maxOver(parseDecimal({average daily error rate}),[{Resource
                  Id}],PRE_AGG)

                  '
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Snapshot Age
                ColumnId: d6f76967-c54b-4ac9-9b9f-6af03f79e4df
                Expression: maxOver(parseDecimal({snapshot age}),[{volume id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Number of Days Over 90% Cpu Utilization
                ColumnId: c352f86e-24de-442a-b314-9165d2da90de
                Expression: maxOver(parseInt({number of days over 90% cpu utilization}),
                  [{instance name}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Total Inbound Rules
                ColumnId: c7cc84c9-26f0-4aab-8f77-533deb13a0ea
                Expression: maxOver(parseInt({total inbound rules}),[{instance id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Total Outbound Rules
                ColumnId: 2dfec784-1361-4d8f-b1a9-4d7200ac6bd9
                Expression: maxOver(parseInt({total outbound rules}),[{instance id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Instance Count
                ColumnId: 754c711b-469a-4800-9772-5d4d6f1c7678
                Expression: maxOver(parseInt({instance count}),[{group id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: S3 Storage (gb)
                ColumnId: bfb2040b-6fba-4461-ba23-4d71ab1af02e
                Expression: maxOver(parseDecimal({s3 storage (gb)}),[{bucket name}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Data Transfer Out (GB)
                ColumnId: 1d903eee-9562-4ce1-84fa-2ce084902974
                Expression: maxOver(parseDecimal({data transfer out (gb)}),[{bucket
                  name}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Ratio of Transfer to Storage
                ColumnId: cf75e0af-3e1e-46e4-bef8-23b53d5876a6
                Expression: maxOver(parseDecimal({ratio of transfer to storage}),[{bucket
                  name}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Max Daily Median
                ColumnId: 4969569f-00c3-4dd2-bea4-30e45b8a9597
                Expression: maxOver(parseDecimal({max daily median}),[{volume id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Number of Days Over
                ColumnId: 43150fa6-4a63-4a74-85b1-4adf93795a4c
                Expression: maxOver(parseInt({number of days over}),[{volume id}],PRE_AGG)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: DateTime is Last Check for Resource
                ColumnId: 4dd256b5-fe3a-4304-b98e-ac9059604f68
                Expression: '{Datetime} = {Last Check for Resource}'
          - CreateColumnsOperation:
              Columns:
              - ColumnName: One Check Selected
                ColumnId: 0ff3cf35-ffeb-4cf4-b379-684c430ccb3c
                Expression: distinctCountOver(checkid, [], PRE_AGG) = 1
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Estimated Monthly Savings
                ColumnId: 5334421f-d73e-4b5f-bdab-b7553553cc25
                Expression: 'ifelse( maxOver(Datetime, [{Resource Id}] , PRE_AGG)
                  = Datetime, {Estimated Monthly Savings Numeric}, null)

                  '
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Estimated Monthly Savings Trend
                ColumnId: 2f67fc2d-9c64-4f14-9d28-f962cad070d8
                Expression: ifelse( maxOver(Datetime, [{Resource Id},extract('MM',
                  Datetime),extract('YYYY', Datetime)] , PRE_AGG) = Datetime, {Estimated
                  Monthly Savings Numeric}, null)
          - CreateColumnsOperation:
              Columns:
              - ColumnName: Account Id
                ColumnId: 2f67fc2d-9c64-4f14-9d28-f962cad070d9
                Expression: accountid
          - CreateColumnsOperation:
              Columns:
              - ColumnName: recommended_action_mod
                ColumnId: a1169805-fa06-474b-b0d1-2d78322d9616
                Expression: "ifelse({checkname} = 'Idle Load Balancers', \"Not Available\"\
                  ,\n{checkname} = 'Underutilized\_Amazon\_Redshift\_Clusters', \"\
                  Not Available\",\n{checkname} = 'AWS\_Lambda\_Functions\_with\_\
                  High\_Error\_Rates', \"Not Available\",\n{checkname} = 'Unassociated\
                  \ Elastic IP Addresses', \"Not Available\",\nisNull({recommended\
                  \ action}), \"Not Available\",\n{recommended action} = '', \"Not\
                  \ Available\",\n{recommended action}\n)"
          - TagColumnOperation:
              ColumnName: region
              Tags:
              - ColumnGeographicRole: STATE
          - TagColumnOperation:
              ColumnName: region name
              Tags:
              - ColumnGeographicRole: STATE
          - TagColumnOperation:
              ColumnName: region api parameter
              Tags:
              - ColumnGeographicRole: STATE
          - ProjectOperation:
              ProjectedColumns:
              - ip address
              - checkname
              - accountparentname
              - accountid
              - category
              - checkid
              - issuppressed
              - resourceid
              - region
              - accountparentid
              - timestamp
              - accountname
              - status
              - acl allows list
              - bucket name
              - acl allows upload/delete
              - region name
              - policy allows access
              - ignored bucket name
              - region api parameter
              - password policy
              - reason
              - number
              - uppercase
              - lowercase
              - non-alphanumeric
              - write enabled
              - same owner
              - target exists
              - target name
              - trail name
              - logging status
              - last delivery error
              - access key
              - key last rotated
              - iam user
              - mfa delete enabled
              - versioning
              - current usage
              - service
              - limit amount
              - limit name
              - snapshot id
              - volume name
              - snapshot age
              - volume attachment
              - volume id
              - snapshot name
              - volume type
              - volume size
              - monthly storage cost
              - max daily median
              - number of days over
              - day 14
              - day 13
              - day 12
              - day 11
              - day 10
              - day 1
              - day 2
              - day 3
              - day 8
              - day 9
              - day 4
              - day 5
              - day 6
              - day 7
              - region/az
              - 14-day average cpu utilization
              - instance type
              - instance name
              - estimated monthly savings
              - 14-day average network i/o
              - number of days low utilization
              - instance id
              - instances in zone a
              - instances in zone b
              - instances in zone e
              - instances in zone f
              - instances in zone c
              - instances in zone d
              - load balancer associated
              - auto scaling group name
              - health check
              - total inbound rules
              - total outbound rules
              - vpc id
              - db instance
              - multi-az
              - security group id
              - ports
              - security group name
              - protocol
              - port
              - ip range
              - customer gateway
              - vpc
              - active tunnels
              - vpn id
              - virtual private gateway
              - distribution domain name
              - distribution id
              - alternate domain name
              - hosted zone name
              - hosted zone id
              - number of name server delegations used
              - number of days over 90% cpu utilization
              - resource name
              - launch configuration name
              - launch type
              - resource type
              - launch name
              - backup retention period
              - description
              - instance count
              - group id
              - resource record set identifier
              - resource record set type
              - alias target
              - resource record set name
              - headers
              - cache behavior path pattern
              - lookback period (days)
              - upfront cost
              - payment option
              - hourly commitment to purchase
              - estimated savings percentage
              - term (years)
              - savings plan type
              - estimated average utilization
              - origin
              - days since last connection
              - db instance name
              - storage provisioned (gb)
              - estimated monthly savings (on demand)
              - cluster
              - estimated break even (months)
              - platform
              - expected average ri utilization
              - estimated on-demand cost post recommended ri purchase (monthly)
              - recommended number of ris to purchase
              - upfront cost of ris
              - estimated savings with recommendation (monthly)
              - estimated cost of ris (monthly)
              - load balancer name
              - '# of zones'
              - access key id
              - case id
              - certificate name
              - connection details
              - connection id for vif
              - connection id
              - current monthly cost
              - data transfer out (gb)
              - database edition
              - database engine
              - db instance or cluster id
              - deadline
              - deployment option
              - ebs optimized
              - estimated cost of reserved instances (monthly)
              - estimated cost of reserved nodes (monthly)
              - estimated on-demand cost post recommended reserved instance purchase
                (monthly)
              - estimated on-demand cost post recommended reserved nodes purchase
                (monthly)
              - expected average reserved instance utilization
              - expected average reserved node utilization
              - expected avergae reserved instance utilization
              - expected avergae reserved node utilization
              - expiration date
              - family
              - fraud type
              - gateway id
              - ingress rule
              - instance class
              - instance size
              - license model
              - load balancer port
              - location for vif
              - location
              - node type
              - private db instances
              - product description
              - public db instances
              - ratio of transfer to storage
              - rds security group name
              - recommended number of reserved instances to purchase
              - recommended number of reserved nodes to purchase
              - reserved instance id
              - resource record set id
              - s3 storage (gb)
              - security group ids
              - time near maximum
              - time updated
              - ttl
              - upfront cost of reserved instances
              - upfront cost of reserved nodes
              - usage (usd per day)
              - user name (iam or root)
              - zone
              - function arn
              - max daily error rate
              - date for max error rate
              - average daily error rate
              - lost daily compute cost
              - current day invokes
              - current day error rate
              - average daily invokes
              - last refresh time
              - max daily timeout rate
              - date of max daily timeout rate
              - average daily timeout rate
              - function timeout setting
              - current day timeout rate
              - runtime
              - days to deprecation
              - deprecation date
              - resource
              - workload type
              - workload last modified date
              - workload started date
              - number of questions answered for performance
              - number of hris resolved for performance
              - total number of questions in performance pillar
              - number of identified hris for performance
              - reviewer name
              - workload arn
              - workload name
              - number of hris resolved for reliability
              - total number of questions in reliability pillar
              - number of questions answered for reliability
              - number of identified hris for reliability
              - number of hris resolved for security
              - total number of questions in security pillar
              - number of questions answered for security
              - number of identified hris for security
              - number of hris resolved for cost optimization
              - total number of questions in cost optimization pillar
              - number of questions answered for cost optimization
              - number of identified hris for cost optimization
              - cluster name
              - resource id
              - recommended action
              - current resource summary
              - recommended resource summary
              - estimated monthly cost
              - last refresh time stamp
              - logging enabled
              - delivery error reported
              - last updated time
              - account_id
              - account_name
              - Check Name
              - Account
              - Resource Id
              - Resource Name
              - Datetime
              - First Check for Resource
              - Last Check for Resource
              - Last Check for Account and CheckId
              - Resource in Last Check
              - Estimated Monthly Savings Numeric
              - Status
              - Category
              - Deprecation Date
              - Average Daily Invokes
              - Number of Days Low Utilization
              - 14-Day Average CPU Utilization
              - 14-Day Average Network I/O
              - Max Daily Error Rate
              - Date for Max Error Rate
              - Average Daily Error Rate
              - Snapshot Age
              - Number of Days Over 90% Cpu Utilization
              - Total Inbound Rules
              - Total Outbound Rules
              - Instance Count
              - S3 Storage (gb)
              - Data Transfer Out (GB)
              - Ratio of Transfer to Storage
              - Max Daily Median
              - Number of Days Over
              - DateTime is Last Check for Resource
              - One Check Selected
              - Estimated Monthly Savings
              - Estimated Monthly Savings Trend
              - Account Id
              - recommended_action_mod
          Source:
            JoinInstruction:
              LeftOperand: b5de237f-b599-407f-87ec-32024624ba65
              RightOperand: 75be0406-c176-4fca-bcc7-b24d75f9ff27
              Type: LEFT
              OnClause: '{accountid} = {account_id}'
        75be0406-c176-4fca-bcc7-b24d75f9ff27:
          Alias: account_map
          Source:
            PhysicalTableId: 99142d9e-0831-40c4-8744-261696fb2f12
        b5de237f-b599-407f-87ec-32024624ba65:
          Alias: ta_org_view
          Source:
            PhysicalTableId: b5de237f-b599-407f-87ec-32024624ba65
      ImportMode: SPICE
    dependsOn:
      views:
      - account_map
      - ta_org_view
    schedules:
    - default
crawlers: {}
views:
  ta_priority_org_view:
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".ta_priority_org_view AS
      WITH
        ranked_recommendations AS (
         SELECT
           recommendationarn
         , name
         , description
         , awsservices
         , date(from_iso8601_timestamp(createdat)) createdat
         , date(from_iso8601_timestamp(resolvedat)) resolvedat
         , date(from_iso8601_timestamp(lastupdatedat)) lastupdatedat
         , lastupdatedat lastupdatedat_string
         , lifecyclestage
         , recommendationstatus
         , pillars
         , source
         , accountid
         , accountname
         , regexp_replace(regexp_replace(regexp_replace(awsresourcedetails, ',\s*', concat(',', chr(10))), '\s*[{}]\s*', ''), '":"', '": "') awsresourcedetails
         , recommresourceid
         , recommresourcearn
         , exclusionstatus
         , regioncode
         , resourcestatus
         , payer_id
         , year
         , month
         , ROW_NUMBER() OVER (PARTITION BY recommendationarn, recommresourceid, year, month ORDER BY lastupdatedat DESC) row_num
         , MAX(lastupdatedat) OVER (PARTITION BY recommendationarn, recommresourceid) max_lastupdatedat
         FROM
           "${data_collection_database_name}"."trusted_advisor_priority_data"
          WHERE (date_parse(concat(year, '-', LPAD(month, 2, '0'), '-01'), '%Y-%m-%d') >= date_add('month', -3, current_date))
      )
      SELECT
        recommendationarn
      , name
      , description
      , awsservices
      , createdat
      , resolvedat
      , lastupdatedat
      , lifecyclestage
      , recommendationstatus
      , pillars
      , source
      , accountid
      , accountname
      , awsresourcedetails
      , recommresourceid
      , recommresourcearn
      , exclusionstatus
      , regioncode
      , resourcestatus
      , payer_id
      , year
      , month
      , (CASE WHEN (lastupdatedat_string = max_lastupdatedat) THEN 1 ELSE 0 END) is_latest_update
      FROM
        ranked_recommendations
      WHERE (row_num = 1)
    parameters:
      data_collection_database_name:
        type: athena
        query: SELECT DISTINCT table_schema FROM information_schema.columns WHERE table_name = 'trusted_advisor_data'
        error: "This means that prerequisites for the dashboard are not found. Please make sure you have the needed table: Data Collection installed, needed module is configured and Step Function runs correctly."
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True
  ta_org_view:
    data: |-
      CREATE OR REPLACE VIEW "${athena_database_name}".ta_org_view AS
      SELECT DISTINCT
        "ip address"
      , "checkname"
      , "accountparentname"
      , "accountid"
      , "category"
      , "checkid"
      , "issuppressed"
      , "resourceid"
      , "region"
      , "accountparentid"
      , "timestamp"
      , "accountname"
      , "status"
      , "acl allows list"
      , "bucket name"
      , "acl allows upload/delete"
      , "region name"
      , "policy allows access"
      , "ignored bucket name"
      , "region api parameter"
      , "password policy"
      , "reason"
      , "number"
      , "uppercase"
      , "lowercase"
      , "non-alphanumeric"
      , "write enabled"
      , "same owner"
      , "target exists"
      , "target name"
      , "trail name"
      , "logging status"
      , "last delivery error"
      , "access key"
      , "key last rotated"
      , "iam user"
      , "mfa delete enabled"
      , "versioning"
      , "current usage"
      , "service"
      , "limit amount"
      , "limit name"
      , "snapshot id"
      , "volume name"
      , "snapshot age"
      , "volume attachment"
      , "volume id"
      , "snapshot name"
      , "volume type"
      , "volume size"
      , "monthly storage cost"
      , "max daily median"
      , "number of days over"
      , "day 14"
      , "day 13"
      , "day 12"
      , "day 11"
      , "day 10"
      , "day 1"
      , "day 2"
      , "day 3"
      , "day 8"
      , "day 9"
      , "day 4"
      , "day 5"
      , "day 6"
      , "day 7"
      , "region/az"
      , "14-day average cpu utilization"
      , "instance type"
      , "instance name"
      , "estimated monthly savings"
      , "14-day average network i/o"
      , "number of days low utilization"
      , "instance id"
      , "instances in zone a"
      , "instances in zone b"
      , "instances in zone e"
      , "instances in zone f"
      , "instances in zone c"
      , "instances in zone d"
      , "load balancer associated"
      , "auto scaling group name"
      , "health check"
      , "total inbound rules"
      , "total outbound rules"
      , "vpc id"
      , "db instance"
      , "multi-az"
      , "security group id"
      , "ports"
      , "security group name"
      , "protocol"
      , "port"
      , "ip range"
      , "customer gateway"
      , "vpc"
      , "active tunnels"
      , "vpn id"
      , "virtual private gateway"
      , "distribution domain name"
      , "distribution id"
      , "alternate domain name"
      , "hosted zone name"
      , "hosted zone id"
      , "number of name server delegations used"
      , "number of days over 90% cpu utilization"
      , "resource name"
      , "launch configuration name"
      , "launch type"
      , "resource type"
      , "launch name"
      , "backup retention period"
      , "description"
      , "instance count"
      , "group id"
      , "resource record set identifier"
      , "resource record set type"
      , "alias target"
      , "resource record set name"
      , "headers"
      , "cache behavior path pattern"
      , "lookback period (days)"
      , "upfront cost"
      , "payment option"
      , "hourly commitment to purchase"
      , "estimated savings percentage"
      , "term (years)"
      , "savings plan type"
      , "estimated average utilization"
      , "origin"
      , "days since last connection"
      , "db instance name"
      , "storage provisioned (gb)"
      , "estimated monthly savings (on demand)"
      , "cluster"
      , "estimated break even (months)"
      , "platform"
      , "expected average ri utilization"
      , "estimated on-demand cost post recommended ri purchase (monthly)"
      , "recommended number of ris to purchase"
      , "upfront cost of ris"
      , "estimated savings with recommendation (monthly)"
      , "estimated cost of ris (monthly)"
      , "load balancer name"
      , "# of zones"
      , "access key id"
      , "case id"
      , "certificate name"
      , "connection details"
      , "connection id for vif"
      , "connection id"
      , "current monthly cost"
      , "data transfer out (gb)"
      , "database edition"
      , "database engine"
      , "db instance or cluster id"
      , "deadline"
      , "deployment option"
      , "ebs optimized"
      , "estimated cost of reserved instances (monthly)"
      , "estimated cost of reserved nodes (monthly)"
      , "estimated on-demand cost post recommended reserved instance purchase (monthly)"
      , "estimated on-demand cost post recommended reserved nodes purchase (monthly)"
      , "expected average reserved instance utilization"
      , "expected average reserved node utilization"
      , "expected avergae reserved instance utilization"
      , "expected avergae reserved node utilization"
      , "expiration date"
      , "family"
      , "fraud type"
      , "gateway id"
      , "ingress rule"
      , "instance class"
      , "instance size"
      , "license model"
      , "load balancer port"
      , "location for vif"
      , "location"
      , "node type"
      , "private db instances"
      , "product description"
      , "public db instances"
      , "ratio of transfer to storage"
      , "rds security group name"
      , "recommended number of reserved instances to purchase"
      , "recommended number of reserved nodes to purchase"
      , "reserved instance id"
      , "resource record set id"
      , "s3 storage (gb)"
      , "security group ids"
      , "time near maximum"
      , "time updated"
      , "ttl"
      , "upfront cost of reserved instances"
      , "upfront cost of reserved nodes"
      , "usage (usd per day)"
      , "user name (iam or root)"
      , "zone"
      , "function arn"
      , "max daily error rate"
      , "date for max error rate"
      , "average daily error rate"
      , "lost daily compute cost"
      , "current day invokes"
      , "current day error rate"
      , "average daily invokes"
      , "last refresh time"
      , "max daily timeout rate"
      , "date of max daily timeout rate"
      , "average daily timeout rate"
      , "function timeout setting"
      , "current day timeout rate"
      , "runtime"
      , "days to deprecation"
      , "deprecation date"
      , "resource"
      , "workload type"
      , "workload last modified date"
      , "workload started date"
      , "number of questions answered for performance"
      , "Number of hris resolved for performance"
      , "total number of questions in performance pillar"
      , "number of identified hris for performance"
      , "reviewer name"
      , "workload arn"
      , "workload name"
      , "number of hris resolved for reliability"
      , "total number of questions in reliability pillar"
      , "number of questions answered for reliability"
      , "number of identified hris for reliability"
      , "number of hris resolved for security"
      , "total number of questions in security pillar"
      , "number of questions answered for security"
      , "number of identified hris for security"
      , "number of hris resolved for cost optimization"
      , "total number of questions in cost optimization pillar"
      , "number of questions answered for cost optimization"
      , "number of identified hris for cost optimization"
      , "cluster name"
      , "resource id"
      , "recommended action"
      , "current resource summary"
      , "recommended resource summary"
      , "estimated monthly cost"
      , "last refresh time stamp"
      , "logging enabled"
      , "delivery error reported"
      , "last updated time"
      FROM
        "${data_collection_database_name}"."trusted_advisor_data"
      WHERE ((NOT ("timestamp" LIKE '%Z%')) AND ("from_unixtime"(CAST(substr("timestamp", 1, 10) AS decimal)) > (current_date - INTERVAL  '3' MONTH)) AND ((status IS NULL) OR (NOT (status IN ('ok', 'Green'))) OR (checkid IN ('Wxdfp4B1L1', 'Wxdfp4B1L2', 'Wxdfp4B1L3', 'Wxdfp4B1L4'))))
    parameters:
      data_collection_database_name:
        type: athena
        query: SELECT DISTINCT table_schema FROM information_schema.columns WHERE table_name = 'trusted_advisor_data'
        error: "This means that prerequisites for the dashboard are not found. Please make sure you have the needed table: Data Collection installed, needed module is configured and Step Function runs correctly."
        default: optimization_data
        description: "Enter the name of the data collection database"
        global: True
